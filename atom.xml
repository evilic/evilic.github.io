<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>子曰要闹闹</title>
  
  <subtitle>写作是思考，而不是记录</subtitle>
  <link href="https://tsz.me/atom.xml" rel="self"/>
  
  <link href="https://tsz.me/"/>
  <updated>2022-09-03T06:39:55.000Z</updated>
  <id>https://tsz.me/</id>
  
  <author>
    <name>Tsz Chiu Wong</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>v2ray环境部署</title>
    <link href="https://tsz.me/p/20220903_v2ray%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%20(%E8%AF%B7%E6%B7%BB%E5%8A%A0%E8%BF%9E%E5%AD%97%E7%AC%A6).html"/>
    <id>https://tsz.me/p/20220903_v2ray%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%20(%E8%AF%B7%E6%B7%BB%E5%8A%A0%E8%BF%9E%E5%AD%97%E7%AC%A6).html</id>
    <published>2022-09-03T06:39:55.000Z</published>
    <updated>2022-09-03T06:39:55.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>8月17日下午，原本正常使用的v2ray服务突然遭遇频繁的<a href="https://itlanyan.com/recovery-blocked-ip/">tcp阻断</a>，网络访问断断续续，大有服务器要跪的样子。无奈这是基础服务，只能放下手头正在开展的工作，转来优先处理这个问题（带着恼怒）。</p><p>我当前isp是联通，远程服务器配置是nginx+tls+websocket+v2ray。上次服务器配置更新是在2年半前，期间也有配置需要调整，但服务运行正常，我懒得没动。</p><p>为处理这个问题，我做了以下前置动作：</p><ul><li>参考他人在相同配置下<a href="https://github.com/v2ray/v2ray-core/issues/2889">v2ray被墙</a>的具体情况；</li><li>了解这两年多<a href="https://www.chengxiaobai.com/essays/v2ray-trojan-xray">翻墙工具有哪些发展</a>；</li></ul><p>最终确定下来，我要趁这个机会做如下调整：</p><ol><li>放弃原本的CentOS，改系统为Debian。CentOS停止支持，换上Debian图个安稳。</li><li>更换原有域名。原有域名只有这一个作用，释放后停止续费节省money。</li><li>给v2ray的新域名套上cloudflare。之前一直不想更换nameserver，也不想处理cdn的https证书，所以没套cdn。<strong>这次套cdn也不一定能用，但至少应该会保住ip。</strong> 在保住ip的前提下，剩下的慢慢解决。</li><li>记录此次配置过程。就因为我一直没写文档，所以在这么长的时间里我没有调整过配置。为此我多花了域名1年的费用…心疼ing。</li></ol><p>说干就干。在tcp阻断的情况下，只能先连国内vps，再ssh到国外vps。还好我有台阿里ecs。</p><h2 id="操作记录"><a href="#操作记录" class="headerlink" title="操作记录"></a>操作记录</h2><h3 id="重装系统"><a href="#重装系统" class="headerlink" title="重装系统"></a>重装系统</h3><p>我的服务器是<a href="https://bwh81.net/">搬瓦工</a>的，重装系统的过程就是<code>关机</code>-<code>登陆官网后台</code>-<code>进入KiwiVM管理页面</code>-<code>Install new OS</code>。没什么好说的，还不会的话看这篇<a href="https://www.bandwagonhost.net/417.html">登录KiwiVM控制面板并重装系统</a>即可。</p><p>重装Debian系统后第一件事就是更新系统。<strong>本篇所有的服务器指令都是直接以root身份执行的。</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt list --upgradable</span><br><span class="line">apt upgrade</span><br><span class="line">sync</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><p>开启防火墙。搬瓦工修改了默认的ssh端口，所以在执行防火墙开启指令<code>ufw enable</code>前，必须先将指定的ssh端口加入允许列表（<code>ufw allow 12345/tcp</code>指令开放了12345端口的tcp连接），否则……即便使用默认ssh端口，在开启防火墙前也要先加入允许。防火墙ufw的详细使用说明可参考<a href="https://www.myfreax.com/how-to-setup-a-firewall-with-ufw-on-debian-10/">在Debian中配置防火墙ufw</a>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install ufw</span><br><span class="line"></span><br><span class="line">ufw status</span><br><span class="line">ufw allow 12345/tcp</span><br><span class="line">ufw enable</span><br><span class="line">ufw status</span><br></pre></td></tr></table></figure><h3 id="安装Nginx（nginx-tls）"><a href="#安装Nginx（nginx-tls）" class="headerlink" title="安装Nginx（nginx+tls）"></a>安装Nginx（nginx+tls）</h3><p>nginx的安装没什么好说的，直接看我另一篇Nginx安装文档就行。</p><p>接下来就是配置nginx，打开防火墙，完成DNS解析。有人说在freenom上可以免费购买域名，但是购买成功可能需要一点技巧。我不想耽误时间，也不想再额外添加一个没有用的域名，即使它是免费的。我这边只提供下信息，谁有需要谁自己去研究。</p><p>配置nginx，添加一个新的空站点。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/share/nginx/html/new_site</span><br><span class="line">cp /usr/share/nginx/html/index.html /usr/share/nginx/html/new_site/</span><br><span class="line">chown -R nginx:nginx /usr/share/nginx/html/new_site/</span><br><span class="line"></span><br><span class="line">cp /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/new_site.conf</span><br><span class="line">mv /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.deleted</span><br></pre></td></tr></table></figure><p><code>vi /etc/nginx/conf.d/new_site.conf</code>，新内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    server_name  newsite.com;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/newsite.com.access.log  main;</span><br><span class="line"></span><br><span class="line">    root   /usr/share/nginx/html/new_site;</span><br><span class="line">    index  index.html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 转发websocket请求到v2ray配置，开始</span><br><span class="line"></span><br><span class="line">    # 转发websocket请求到v2ray配置，结束</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使新站点配置生效：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx -t</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><p>防火墙允许80、443端口访问。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ufw status</span><br><span class="line">ufw allow http</span><br><span class="line">ufw allow https</span><br><span class="line">ufw status</span><br></pre></td></tr></table></figure><p>在完成newsite.com域名的dns解析后，网站已经可以正常访问了。接下来我们会为网站开启https。此处我是通过<a href="https://cn.ubuntu.com/blog/what-is-snap-application">snapd</a>安装<a href="https://certbot.eff.org/instructions?ws=nginx&os=debianbuster">certbot</a>，并使用certbot获取https证书的。<code>certbot --nginx</code>会自动修改nginx配置文件以开启站点https访问。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install snapd</span><br><span class="line">sync</span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line">snap install core</span><br><span class="line">snap refresh core</span><br><span class="line">snap install --classic certbot</span><br><span class="line">ln -s /snap/bin/certbot /usr/bin/certbot</span><br><span class="line"></span><br><span class="line">certbot --nginx</span><br></pre></td></tr></table></figure><p>至此，tls也有了。</p><h3 id="v2ray安装（v2ray-websocket）"><a href="#v2ray安装（v2ray-websocket）" class="headerlink" title="v2ray安装（v2ray+websocket）"></a>v2ray安装（v2ray+websocket）</h3><p>安装v2ray。v2ray的官网现在是<a href="https://www.v2fly.org/">v2fly</a>了，这是需要注意的。它的文档中包含了<a href="https://www.v2fly.org/guide/install.html">Debian下v2ray的安装</a>。具体指令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install v2ray</span><br><span class="line">v2ray -version</span><br><span class="line">systemctl status v2ray</span><br></pre></td></tr></table></figure><p>额外补充几点，省得我日后还要重新看它的文档：</p><ol><li>我丝毫不关心官方文档中说的<code>Unstable 仓库</code>到底是什么，官方配置步骤中的1、2、3被直接跳过；</li><li>这样直接安装的v2ray的版本号是<code>4.34.0</code>，写在这里是为了日后配置v2ray时方便确认该版本是否支持新功能；</li><li>官方配置文档中使用<code>systemctl edit v2ray.service</code>特别指定日志目录不是必需的，你不一定需要开启v2ray日志；<strong>我开启了日志，所以也执行了官方此步骤的推荐配置；</strong></li><li><code>systemctl edit v2ray.service</code>命令相当于执行<code>vi /usr/lib/systemd/system/v2ray.service</code>后再执行<code>systemctl daemon-reload</code>，它们是等效的。</li><li>v2ray默认的配置文件是<code>/etc/v2ray/config.json</code>。</li></ol><p>配置v2ray，<code>vi /etc/v2ray/config.json</code>修改文件内容如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;log&quot;</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;access&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/log/v2ray/access.log&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/log/v2ray/error.log&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;loglevel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;warning&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;inbounds&quot;</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;sniffing&quot;</span><span class="punctuation">:</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;destOverride&quot;</span><span class="punctuation">:</span></span><br><span class="line">                <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;http&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="string">&quot;tls&quot;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">22222</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;listen&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;clients&quot;</span><span class="punctuation">:</span></span><br><span class="line">                <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;57d47ad2-9b73-4991-a8c5-394f89522c0e&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;alterId&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;streamSettings&quot;</span><span class="punctuation">:</span> </span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ws&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;wsSettings&quot;</span><span class="punctuation">:</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/fxxKThEW0r1d&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;outbounds&quot;</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;freedom&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;blackhole&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;blocked&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;routing&quot;</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;domainStrategy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AsIs&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;rules&quot;</span><span class="punctuation">:</span></span><br><span class="line">        <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;block&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span></span><br><span class="line">                <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;bittorrent&quot;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>关于配置文件的几点说明：</p><ul><li>此配置<strong>开启了日志</strong>；</li><li>此配置开启了流量嗅探，不开启嗅探没办法知道客户端在跑bt；</li><li>此配置将所有的bt流量都封锁了，以免被vps提供商拒绝服务；</li><li>此配置监听本地<code>127.0.0.1</code>地址的<code>22222</code>端口，且<code>127.0.0.1</code>地址无法通过外网IP直接访问；</li><li>此配置中有一个用户<code>57d47ad2-9b73-4991-a8c5-394f89522c0e</code>；</li><li>此配置允许在vps上通过访问<code>http://127.0.0.1:22222/fxxKThEW0r1d</code>进行<code>websocket</code>通信。</li><li><a href="https://guide.v2fly.org/">新V2Ray白话文指南</a>上提供了很多实用的v2ray配置技巧，你可以拿来学习参考。</li><li><strong>我对v2ray配置的看法是，如果只是拿来翻墙用，完全没有必要了解太多，谁知道它哪天就被封了。</strong></li><li><code>&quot;alterId&quot;: 0</code>这一项是当前v2ray版本的推荐配置；</li><li><code>&quot;path&quot;: &quot;/fxxKThEW0r1d&quot;</code>这一项是大家推荐的使用乱码，虽然我认为这样做也没有任何意义……</li><li>此配置不需要配置防火墙，因为监听的IP地址是本地IP。</li></ul><p>使新配置生效。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v2ray -test</span><br><span class="line">systemctl restart v2ray</span><br></pre></td></tr></table></figure><p>有坑列一下，能帮助一个是一个：</p><ul><li>如果你不用nginx做前端，而是直接让v2ray以tcp tls的方式来提供服务，需要以root身份来启动v2ray，否则会报错。因为你需要让v2ray去读取证书文件，而普通用户没有读取证书文件的权限。以root方式启动v2ray需要修改v2ray.service文件。不建议使用这种配置，被墙风险高，还给v2ray提权了。不想给v2ray提权就还老老实实的用nginx。既然都用nginx了就把websocket给加上。主要这是官方文档的锅，把v2ray的tcp tls教程放在第一篇。</li></ul><h3 id="整合nginx-v2ray（nginx-tls-websocket-v2ray）"><a href="#整合nginx-v2ray（nginx-tls-websocket-v2ray）" class="headerlink" title="整合nginx+v2ray（nginx+tls+websocket+v2ray）"></a>整合nginx+v2ray（nginx+tls+websocket+v2ray）</h3><p>整合nginx与v2ray的过程，就是让nginx将收到的来自公网的websocket请求转发到监听本地地址的v2ray上。</p><p>你只需要<code>vi /etc/nginx/conf.d/new_site.conf</code>，在<code># 转发websocket请求到v2ray配置，开始</code>和<code># 转发websocket请求到v2ray配置，结束</code>中间的空白行上<strong>添加</strong>如下内容即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">location /fxxKThEW0r1d &#123;</span><br><span class="line">    if ($http_upgrade != &quot;websocket&quot;) &#123;</span><br><span class="line">        return 404;</span><br><span class="line">    &#125;</span><br><span class="line">    proxy_redirect off;</span><br><span class="line">    proxy_pass http://127.0.0.1:22222;</span><br><span class="line">    proxy_http_version 1.1;</span><br><span class="line">    proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">    proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    # Show real IP in v2ray access.log</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使nginx新配置生效：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx -t</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><h3 id="配置Cloudflare（CDN）"><a href="#配置Cloudflare（CDN）" class="headerlink" title="配置Cloudflare（CDN）"></a>配置Cloudflare（CDN）</h3><p>终于来到了之前没来过的地方。</p><p>原本是直接访问自己站点的，但是在站点前加一个cdn，我们在访问自己网站的时候会访问cdn的节点，数据由cdn提供。cdn提供的数据是它访问我们网站返回的。这样做的好处就是我们隐藏了自己网站的ip地址——我们连接的是cdn节点的ip，防火墙一般不会ban cdn的ip。</p><p>为了使用cf的cdn，我们需要把nameserver换成cf提供的ns。在更换ns的过程中，需要对比原来的域名解析记录，将这些记录在cf里面补全——cf在没有成为域名指定的ns前无法获取全部的解析记录。</p><p>设置完ns后，<strong>设置cf连接的加密方式为“Full SSL”，注意，不是“Full SSL (strict)”。</strong> 为了省事儿，<strong>我们不强迫使用https，允许用户访问http。</strong> 这里说的省事儿，是我还想把证书的获取工作交给Let’s Encrypt去做：cf的证书要么收费，要么还需要配置。而Let’s Encrypt的证书每3个月需要更新一次，更新的时候它会访问网站自身的http，而不是网站自身的https。如果设置cf强制转换请求为https，Let’s Encrypt可能会无法正常更新证书。</p><p>配置完成cf后，我们可以验证一下网站https证书延期的功能是否正常：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot renew --dry-run</span><br></pre></td></tr></table></figure><p>关于cf配置过程中的坑记录一下：</p><ul><li>有人说把cloudflare workers当reverse proxy使用也可以完成网站的IP隐藏。这种不需要设置ns的方法对我诱惑挺大，但实际测试结果是无法正常访问v2ray，是不可行的。它会报错<code>[Warning] app/proxyman/outbound: failed to process outbound traffic &gt; proxy/vmess/outbound: failed to find an available destination &gt; common/retry: [transport/internet/websocket: failed to dial WebSocket &gt; transport/internet/websocket: failed to dial to (wss://hello-my-friend-365.v2ray.workers.dev/fxxKThEW0r1d): &gt; remote error: tls: handshake failure] &gt; common/retry: all retry attempts failed</code>。从报错上来看，是由于cloudflare workers使用的是cf颁发的证书，而不是我们站点自己的https证书导致的。直接使用cdn才能解决这个证书问题，因为cdn使用的是我们站点自己的证书。</li></ul><p>在配置cf前我还查了一些资料，放出来以防有人需要：</p><ul><li><a href="https://blog.xiaoben.li/p/937">在使用Cloudflare的网站上，签发Let’s Encrypt证书的问题</a></li><li><a href="https://support.cloudflare.com/hc/zh-cn/articles/214820528-%E9%AA%8C%E8%AF%81%E5%B7%B2%E5%9C%A8-Cloudflare-%E4%B8%8A%E6%BF%80%E6%B4%BB%E7%9A%84%E7%AB%99%E7%82%B9%E7%9A%84-Let-s-Encrypt-%E8%AF%81%E4%B9%A6">验证已在Cloudflare上激活的站点的Let’s Encrypt证书</a> - 这是cf官方的文章</li><li><a href="https://blog.morningp.name/2020/03/06/23.html">let’s encrypt配合cloudflare CDN使用</a> - 此人思路新奇……</li></ul><p>至此，cdn+nginx+tls+websocket+v2ray的配置全部完成。</p><p>有人说可以通过工具优选Cloudflare CDN节点IP，进而加快v2ray的访问。我也没有尝试。</p><h3 id="系统优化"><a href="#系统优化" class="headerlink" title="系统优化"></a>系统优化</h3><p>有人说配置bbr效果会比较好。可惜我一行<code>sysctl net.ipv4.tcp_congestion_control</code>下去发现搬瓦工已经默认启用bbr了。有需要的朋友自己去看<a href="https://wiki.crowncloud.net/?How_to_enable_BBR_on_Debian_11">How to Enable BBR on Debian</a>。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>结果：还是时断时续的，而且延时（ping）加大，下载速度变慢。不过总算是不担心vps IP彻底被ban了，可以开始担心域名被干了。</p><p>完成这些配置后，至少可以省下未来域名的钱，和更换IP的钱了，不算亏。</p><p>为了心里更有底一点，我还下载了tor到本地，好在彻底断网的时候还能临时顶一顶，让我能够有一个窗口期去寻找新的解决办法。tor没有与v2ray配合，只是单独使用。v2ray被封的时候，配合使用也没有意义，不是么。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h2&gt;&lt;p&gt;8月17日下午，原本正常使用的v2ray服务突然遭遇频繁的&lt;a href=&quot;https://itlanyan.com/recovery-bl</summary>
      
    
    
    
    <category term="原创" scheme="https://tsz.me/categories/%E5%8E%9F%E5%88%9B/"/>
    
    
    <category term="技术类" scheme="https://tsz.me/tags/%E6%8A%80%E6%9C%AF%E7%B1%BB/"/>
    
  </entry>
  
  <entry>
    <title>LEMP/LNMP环境搭建（Debian 11）</title>
    <link href="https://tsz.me/p/20220512_install-nginx-mariadb-php-lemp-lnmp-stack.html"/>
    <id>https://tsz.me/p/20220512_install-nginx-mariadb-php-lemp-lnmp-stack.html</id>
    <published>2022-05-12T08:09:36.000Z</published>
    <updated>2022-05-12T08:09:36.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="LNMP环境搭建说明"><a href="#LNMP环境搭建说明" class="headerlink" title="LNMP环境搭建说明"></a>LNMP环境搭建说明</h2><p><img src="/images/lnmp-on-debian-11.png" alt="LNMP环境搭建"></p><p>有些问题需要提前说明一下：</p><ol><li>本文是<a href="/p/20220511_debian-11-installation-guide.html">Debian 11安装与基本配置</a>一文的后续。本文中会用到<code>sudo</code>命令，它的配置可参考该文；</li><li>本次进行LEMP&#x2F;LNMP环境搭建的目的，是为了进行WordPress搭建。本文PHP安装的部分提到的扩展都是基于WordPress的需要。请根据你的实际需要安装PHP扩展，而不是直接按照本文安装上一坨你可能不需要的扩展；</li><li>Debian 11防火墙默认没有规则，所以本文中不包含任何防火墙的端口放行设置（我甚至没有开防火墙）。在生产环境中请配置合适的防火墙规则。</li></ol><p>LEMP&#x2F;LNMP环境搭建包括以下内容：(E)Nginx安装、MySQL&#x2F;MariaDB安装和PHP安装。它们是实现web服务器的<del>一个栈</del>一套程序集。</p><h2 id="Nginx安装"><a href="#Nginx安装" class="headerlink" title="Nginx安装"></a>Nginx安装</h2><p>Nginx是一个免费的开源网络服务器，提供HTTP请求处理、反向代理、缓存和负载均衡等功能。它易于设置，是Apache的替代品。</p><p>这里我<strong>安装的是Nginx官方源提供的版本</strong>，而不是Debian官方源提供的版本。<a href="https://nginx.org/en/linux_packages.html#Debian">Nginx官方的安装文档</a>写的很是详细，我们照着来就好~</p><p>安装依赖</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ sudo apt install curl gnupg2 ca-certificates lsb-release debian-archive-keyring</span><br></pre></td></tr></table></figure><p>下载官方的签名密钥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ curl https://nginx.org/keys/nginx_signing.key | gpg --dearmor | sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt; /dev/null</span><br></pre></td></tr></table></figure><p>验证密钥指纹（瞪大双眼，肉眼比对官网提供的数据与本地的显示是否一致）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ gpg --dry-run --quiet --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg</span><br></pre></td></tr></table></figure><p>将nginx的稳定源加入系统</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ echo &quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \</span><br><span class="line">http://nginx.org/packages/debian `lsb_release -cs` nginx&quot; | sudo tee /etc/apt/sources.list.d/nginx.list</span><br></pre></td></tr></table></figure><p>设置nginx官方源的优先级高于Debian系统的官方仓库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ echo -e &quot;Package: *\nPin: origin nginx.org\nPin: release o=nginx\nPin-Priority: 900\n&quot; | sudo tee /etc/apt/preferences.d/99nginx</span><br></pre></td></tr></table></figure><p>更新源，并安装nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ sudo apt update</span><br><span class="line">testu@bogon:~$ sudo apt install nginx</span><br></pre></td></tr></table></figure><p>下面是一些你可能会用到的命令或数据，我随便打一下，你配合着随便看一下。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ sudo nginx -V                       &lt;-- 查看nginx的编译参数</span><br><span class="line">testu@bogon:~$ cat /etc/nginx/nginx.conf           &lt;-- 查看nginx的配置文件</span><br><span class="line">testu@bogon:~$ cat /etc/nginx/conf.d/default.conf  &lt;-- 还是nginx的配置文件</span><br><span class="line">testu@bogon:~$ systemctl status nginx              &lt;-- 查看nginx服务的状态</span><br><span class="line">testu@bogon:~$ sudo systemctl start nginx          &lt;-- 启动nginx服务</span><br><span class="line">testu@bogon:~$ sudo systemctl enable nginx         &lt;-- 设置nginx开机启动</span><br><span class="line">testu@bogon:~$ systemctl status nginx              &lt;-- 确认nginx服务的启动状态</span><br><span class="line">testu@bogon:~$ ip a                                &lt;-- 查看本机IP地址</span><br></pre></td></tr></table></figure><p><img src="/images/welcome-to-nginx.png" alt="Nginx安装-成功"></p><p>通过服务器的IP地址打开网站，显示欢迎界面表示Nginx成功安装。至于Nginx站点的配置文件，我们在安装完php后回头一起配置。</p><h2 id="MariaDB安装"><a href="#MariaDB安装" class="headerlink" title="MariaDB安装"></a>MariaDB安装</h2><p>MariaDB是MySQL的直接替代品，完全兼容MySQL，支持所有标准的MySQL功能，包括API和命令行等。</p><h3 id="MariaDB的版本选择"><a href="#MariaDB的版本选择" class="headerlink" title="MariaDB的版本选择"></a>MariaDB的版本选择</h3><p>我们可以在MariaDB的<a href="https://mariadb.com/kb/en/mariadb-server-release-dates/">知识库页面</a>中了解到：</p><ul><li><del>10.7版本是一个短期支持版本</del>（直接不考虑）</li><li><strong>10.6版本是一个长期支持版本</strong></li><li>10.5支持到2025年6月24号</li></ul><p>通过以下命令，我们可以检查Debian官方源提供的mariadb-server是哪个版本的：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ apt-cache search mariadb-server</span><br><span class="line">testu@bogon:~$ apt-cache show mariadb-server</span><br></pre></td></tr></table></figure><p><img src="/images/mariadb-server-105.png" alt="Debian 11自带源默认MariaDB 10.5版本"></p><p>我们可以看到系统自带源中的MariaDB是10.5版本的。</p><p>在WordPress<a href="https://wordpress.org/about/requirements/">需求页面</a>上，我们可以查到WordPress对MariaDB版本的最低要求是10.2。</p><p>综上，<strong>我们直接安装系统自带源中的MariaDB（10.5版本，MariaDB官方支持到2025年6月24日）</strong>即可。</p><h3 id="安装MariaDB"><a href="#安装MariaDB" class="headerlink" title="安装MariaDB"></a>安装MariaDB</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ sudo apt update                                 &lt;-- 更新源</span><br><span class="line">testu@bogon:~$ sudo apt install mariadb-server                 &lt;-- 安装mariadb-server</span><br><span class="line">testu@bogon:~$ systemctl status mariadb                        &lt;-- 确认mariadb已启动</span><br><span class="line">testu@bogon:~$ sudo mysql_secure_installation                  &lt;-- 执行数据库自带的安全脚本</span><br><span class="line">testu@bogon:~$ whereis mysql</span><br><span class="line">testu@bogon:~$ ls -al /usr/bin/mysql                           &lt;-- 此处只是为了让亲知道mysql是一个指向mariadb的链接</span><br><span class="line">testu@bogon:~$ mariadb --help | head -n 10                     &lt;-- 查看mariadb的配置文件位置</span><br><span class="line">mariadb  Ver 15.1 Distrib 10.5.15-MariaDB, for debian-linux-gnu (x86_64) using  EditLine wrapper</span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Usage: mariadb [OPTIONS] [database]</span><br><span class="line"></span><br><span class="line">Default options are read from the following files in the given order:</span><br><span class="line">/etc/my.cnf /etc/mysql/my.cnf ~/.my.cnf</span><br><span class="line">The following groups are read: mysql mariadb-client client client-server client-mariadb</span><br><span class="line">The following options may be given as the first argument:</span><br><span class="line">--print-defaults          Print the program argument list and exit.</span><br><span class="line"></span><br><span class="line">testu@bogon:~$ ls -al /etc/my.cnf /etc/mysql/my.cnf ~/.my.cnf  &lt;-- /etc/my.cnf和~/.my.cnf文件都不存在，/etc/mysql/my.cnf是配置文件</span><br><span class="line">testu@bogon:~$ cat /etc/mysql/my.cnf                           &lt;-- 查看/etc/mysql/my.cnf配置文件，发现它加载/etc/mysql/conf.d/和/etc/mysql/mariadb.conf.d/目录下的.cnf配置文件</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The MariaDB configuration file</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># The MariaDB/MySQL tools read configuration files in the following order:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">0. <span class="string">&quot;/etc/mysql/my.cnf&quot;</span> symlinks to this file, reason why all the rest is <span class="built_in">read</span>.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. <span class="string">&quot;/etc/mysql/mariadb.cnf&quot;</span> (this file) to <span class="built_in">set</span> global defaults,</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. <span class="string">&quot;/etc/mysql/conf.d/*.cnf&quot;</span> to <span class="built_in">set</span> global options.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3. <span class="string">&quot;/etc/mysql/mariadb.conf.d/*.cnf&quot;</span> to <span class="built_in">set</span> MariaDB-only options.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4. <span class="string">&quot;~/.my.cnf&quot;</span> to <span class="built_in">set</span> user-specific options.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">[client-server]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Port or socket location <span class="built_in">where</span> to connect</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">port = 3306</span></span><br><span class="line">socket = /run/mysqld/mysqld.sock</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Import all .cnf files from configuration directory</span></span><br><span class="line">!includedir /etc/mysql/conf.d/</span><br><span class="line">!includedir /etc/mysql/mariadb.conf.d/</span><br><span class="line"></span><br><span class="line">testu@bogon:~$ ls -al /etc/mysql/mariadb.conf.d/</span><br><span class="line">testu@bogon:~$ cat /etc/mysql/mariadb.conf.d/50-server.cnf     &lt;-- 数据库配置文件位置</span><br><span class="line">testu@bogon:~$ sudo netstat -ap | grep mariadb                 &lt;-- 查看数据库的监听情况</span><br><span class="line">testu@bogon:~$ sudo systemctl enable mariadb                   &lt;-- 设置开机启动</span><br></pre></td></tr></table></figure><p>更多关于配置文件的信息，可以查看<a href="https://mariadb.com/kb/en/configuring-mariadb-with-option-files/">MariaDB文档</a>。</p><h3 id="新建数据库和用户，并进行授权"><a href="#新建数据库和用户，并进行授权" class="headerlink" title="新建数据库和用户，并进行授权"></a>新建数据库和用户，并进行授权</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ mysql -uroot -p</span><br><span class="line">Enter password:</span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">MariaDB [(none)]&gt; create database testenv;                                                     &lt;-- 新建数据库</span><br><span class="line">MariaDB [(none)]&gt; create user &#x27;testd&#x27;@&#x27;localhost&#x27; identified by &#x27;123456&#x27;;                      &lt;-- 添加新用户</span><br><span class="line">MariaDB [(none)]&gt; grant all privileges on testenv.* to &#x27;testd&#x27;@&#x27;localhost&#x27; with grant option;  &lt;-- 授权新用户拥有指定数据库的权限</span><br><span class="line">MariaDB [(none)]&gt; flush privileges;                                                            &lt;-- 刷新使之立刻生效</span><br><span class="line">MariaDB [(none)]&gt; exit</span><br><span class="line"></span><br><span class="line">testu@bogon:~$ mysql -utestd -p</span><br><span class="line">Enter password:</span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">MariaDB [(none)]&gt; exit</span><br></pre></td></tr></table></figure><p>当然，以上新建数据库、用户和授权操作你也可以使用数据库工具完成，例如Navicat，MySQL <a href="https://www.mysql.com/cn/products/workbench/">Workbench</a>等。需要注意的是MariaDB默认监听的是本地127.0.0.1的IP，如果使用连接工具的话，需要配置SSH连接后再进行数据库连接。具体见下面两张图。另外的解决办法就是修改MariaDB的配置文件使其监听可访问的IP，如有需要还要额外设置防火墙规则。出于安全和我懒的原因，我保持原状——不改配置，使用数据库工具连接SSH后连接数据库。</p><p><img src="/images/mariadb-listen-on-localhost.png" alt="MariaDB默认监听本地地址"></p><p><img src="/images/navicat-ssh-db.png" alt="Navicat配置SSH连接"></p><h2 id="PHP安装"><a href="#PHP安装" class="headerlink" title="PHP安装"></a>PHP安装</h2><p>PHP FastCGI进程管理器（FPM）是FastCGI PHP的替代品，其有更优的产品功能和特性，每秒可以处理更多的请求，可以更高效的处理规模和流量更大的站点。</p><h3 id="PHP版本的选择"><a href="#PHP版本的选择" class="headerlink" title="PHP版本的选择"></a>PHP版本的选择</h3><p>在WordPress<a href="https://wordpress.org/about/requirements/">需求页面</a>上，我们可以查到WordPress对PHP版本的最低要求是7.4。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ apt-cache search php-fpm</span><br><span class="line">testu@bogon:~$ apt-cache show php-fpm</span><br></pre></td></tr></table></figure><p><img src="/images/debian-php-74.png" alt="Debian 11自带源默认php-fpm 7.4版本"></p><p>通过以上指令，我们可以确认官方源自带php-fpm的版本就是7.4，所以我们<strong>直接安装系统自带的版本（7.4版本）</strong>就好。</p><h3 id="PHP及扩展的安装"><a href="#PHP及扩展的安装" class="headerlink" title="PHP及扩展的安装"></a>PHP及扩展的安装</h3><p>从WordPress官方文档上我们可以看到<a href="https://make.wordpress.org/hosting/handbook/server-environment/#php-extensions">WordPress所需的PHP扩展</a>及<a href="https://make.wordpress.org/hosting/handbook/server-environment/#system-packages">WordPress所要求的服务器软件包</a>。</p><p>直接安装是会报错的，如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ sudo apt install php-fpm php-&#123;json,mysql,curl,dom,exif,fileinfo,hash,imagick,mbstring,openssl,pcre,xml,zip,bcmath,filter,gd,iconv,intl,mcrypt,simplexml,sodium,xmlreader,zlib,ssh2,ftp,sockets&#125;</span><br><span class="line">[sudo] password for testu: </span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">Note, selecting &#x27;php7.4-xml&#x27; instead of &#x27;php-dom&#x27;</span><br><span class="line">Note, selecting &#x27;php7.4-common&#x27; instead of &#x27;php-exif&#x27;</span><br><span class="line">Note, selecting &#x27;php7.4-common&#x27; instead of &#x27;php-fileinfo&#x27;</span><br><span class="line">Note, selecting &#x27;php7.4-common&#x27; instead of &#x27;php-iconv&#x27;</span><br><span class="line">Note, selecting &#x27;php7.4-xml&#x27; instead of &#x27;php-simplexml&#x27;</span><br><span class="line">Note, selecting &#x27;php7.4-xml&#x27; instead of &#x27;php-xmlreader&#x27;</span><br><span class="line">Note, selecting &#x27;php7.4-common&#x27; instead of &#x27;php-ftp&#x27;</span><br><span class="line">Note, selecting &#x27;php7.4-common&#x27; instead of &#x27;php-sockets&#x27;</span><br><span class="line">Package php-mcrypt is not available, but is referred to by another package.</span><br><span class="line">This may mean that the package is missing, has been obsoleted, or</span><br><span class="line">is only available from another source</span><br><span class="line"></span><br><span class="line">E: Unable to locate package php-hash</span><br><span class="line">E: Unable to locate package php-openssl</span><br><span class="line">E: Unable to locate package php-pcre</span><br><span class="line">E: Unable to locate package php-filter</span><br><span class="line">E: Package &#x27;php-mcrypt&#x27; has no installation candidate</span><br><span class="line">E: Unable to locate package php-sodium</span><br><span class="line">E: Unable to locate package php-zlib</span><br></pre></td></tr></table></figure><p>之所以报错是因为PHP版本升级，扩展有些变动，我们敲的命令再正确了。时空变换，人非物也非。我们换个姿势，再来一次：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ sudo apt install openssl libssl-dev libpcre3 libpcre3-dev libsodium23 libsodium-dev zlib1g zlib1g-dev libmcrypt4 libmcrypt-dev imagemagick ghostscript</span><br><span class="line">testu@bogon:~$ sudo apt install php7.4-fpm php7.4-&#123;json,mysql,curl,common,imagick,mbstring,xml,zip,bcmath,gd,intl,ssh2&#125;</span><br><span class="line">testu@bogon:~$ php -i                                &lt;-- 显示php信息</span><br><span class="line">testu@bogon:~$ systemctl status php7.4-fpm           &lt;-- 查看php7.4-fpm服务状态，上面也会显示php-fpm所采用的配置文件为/etc/php/7.4/fpm/php-fpm.conf</span><br><span class="line">testu@bogon:~$ cat /etc/php/7.4/fpm/php-fpm.conf     &lt;-- php-fpm配置文件，实际加载了/etc/php/7.4/fpm/pool.d/目录下的所有.conf配置文件</span><br><span class="line">testu@bogon:~$ cat /etc/php/7.4/fpm/pool.d/www.conf  &lt;-- php-fpm的实际配置文件</span><br><span class="line">testu@bogon:~$ cat /etc/php/7.4/fpm/php.ini          &lt;-- php配置文件</span><br></pre></td></tr></table></figure><h3 id="配置php-fpm"><a href="#配置php-fpm" class="headerlink" title="配置php-fpm"></a>配置php-fpm</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ cat /etc/nginx/nginx.conf                    &lt;-- 确认nginx启动的用户，为nginx</span><br><span class="line">testu@bogon:~$ id nginx</span><br><span class="line">testu@bogon:~$ sudo vi /etc/php/7.4/fpm/pool.d/www.conf     &lt;-- 编辑user、group、listen.owner和listen.group属性，改为与nginx启动相同的用户——即nginx</span><br><span class="line">testu@bogon:~$ sudo sed -i &#x27;s/;cgi.fix_pathinfo=1/cgi.fix_pathinfo=0/g&#x27; /etc/php/7.4/fpm/php.ini</span><br><span class="line">testu@bogon:~$ sudo systemctl restart php7.4-fpm            &lt;-- 重启php7.4-fpm服务</span><br><span class="line">testu@bogon:~$ ls -al /run/php/php7.4-fpm.sock              &lt;-- 确认socket用户已变更</span><br><span class="line">testu@bogon:~$ sudo systemctl enable php7.4-fpm             &lt;-- 设置php-fpm服务开机启动</span><br></pre></td></tr></table></figure><p><img src="/images/php-fpm-config.png" alt="配置PHP后的结果"></p><p>配置后大概是这个样子的，如上图所示。</p><h2 id="WordPress搭建"><a href="#WordPress搭建" class="headerlink" title="WordPress搭建"></a>WordPress搭建</h2><h3 id="配置Nginx支持php网页"><a href="#配置Nginx支持php网页" class="headerlink" title="配置Nginx支持php网页"></a>配置Nginx支持php网页</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ sudo cp /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.20220507.bak  &lt;-- 备份nginx当前的站点配置</span><br><span class="line">testu@bogon:~$ sudo mkdir -p /usr/share/nginx/html/test-env-website                                &lt;-- 建立新站点的根目录</span><br><span class="line">testu@bogon:~$ sudo chown -R nginx:nginx /usr/share/nginx/html/test-env-website/                   &lt;-- 变更站点目录的所有者为nginx用户</span><br><span class="line">testu@bogon:~$ ls -al /usr/share/nginx/html/test-env-website/</span><br><span class="line">testu@bogon:~$ sudo vi /etc/nginx/conf.d/default.conf                                              &lt;-- 编辑nginx的站点配置，文件内容贴在下方</span><br><span class="line">testu@bogon:~$ sudo nginx -t                                                                       &lt;-- 验证nginx配置的正确性</span><br><span class="line">testu@bogon:~$ sudo nginx -s reload                                                                &lt;-- 让nginx重新加载配置文件，使配置生效</span><br><span class="line">testu@bogon:~$ sudo vi /usr/share/nginx/html/test-env-website/info.php                             &lt;-- 在站点目录下写一个php文件，验证php配置正确</span><br></pre></td></tr></table></figure><p>修改后的nginx的站点配置文件<code>/etc/nginx/conf.d/default.conf</code>内容如下，即混合了WordPress官方推荐的Nginx配置（<a href="https://wordpress.org/support/article/nginx/">链接一</a>、<a href="https://www.nginx.com/resources/wiki/start/topics/recipes/wordpress/">链接二</a>）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"># /etc/nginx/conf.d/default.conf</span><br><span class="line"></span><br><span class="line"># WordPress single site rules.</span><br><span class="line"># Designed to be included in any server &#123;&#125; block.</span><br><span class="line"># Upstream to abstract backend connection(s) for php</span><br><span class="line">upstream php &#123;</span><br><span class="line">        server unix:/run/php/php7.4-fpm.sock;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #access_log  /var/log/nginx/host.access.log  main;</span><br><span class="line"></span><br><span class="line">    root   /usr/share/nginx/html/test-env-website;</span><br><span class="line">    index  index.php index.html index.htm;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        # This is cool because no php is touched for static content.</span><br><span class="line">        # include the &quot;?$args&quot; part so non-default permalinks doesn&#x27;t break when using query string</span><br><span class="line">        try_files $uri $uri/ /index.php?$args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">    # redirect server error pages to the static page /50x.html</span><br><span class="line">    #</span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">    #</span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        #NOTE: You should have &quot;cgi.fix_pathinfo = 0;&quot; in php.ini</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">        fastcgi_intercept_errors on;</span><br><span class="line">        fastcgi_pass php;</span><br><span class="line">        #The following parameter can be also included in fastcgi_params file</span><br><span class="line">        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # WordPress global restrictions file</span><br><span class="line"></span><br><span class="line">    # Global restrictions configuration file.</span><br><span class="line">    # Designed to be included in any server &#123;&#125; block.</span><br><span class="line">    location = /favicon.ico &#123;</span><br><span class="line">        log_not_found off;</span><br><span class="line">        access_log off;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    location = /robots.txt &#123;</span><br><span class="line">        allow all;</span><br><span class="line">        log_not_found off;</span><br><span class="line">        access_log off;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    # Deny all attempts to access hidden files such as .htaccess, .htpasswd, .DS_Store (Mac).</span><br><span class="line">    # Keep logging the requests to parse later (or to pass to firewall utilities such as fail2ban)</span><br><span class="line">    location ~ /\. &#123;</span><br><span class="line">        deny all;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    # Deny access to any files with a .php extension in the uploads directory</span><br><span class="line">    # Works in sub-directory installs and also in multisite network</span><br><span class="line">    # Keep logging the requests to parse later (or to pass to firewall utilities such as fail2ban)</span><br><span class="line">    location ~* /(?:uploads|files)/.*\.php$ &#123;</span><br><span class="line">        deny all;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # General WordPress rules</span><br><span class="line"></span><br><span class="line">    location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ &#123;</span><br><span class="line">        expires max;</span><br><span class="line">        log_not_found off;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用于验证php配置的<code>/usr/share/nginx/html/test-env-website/info.php</code>文件内容如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();</span><br></pre></td></tr></table></figure><p><img src="/images/check-nginx-php-config.png" alt="PHP安装-验证成功"></p><p>通过IP地址访问站点下的info.php页面，成功显示内容表示Nginx-PHP被正确配置。撒花。</p><h3 id="WordPress搭建-1"><a href="#WordPress搭建-1" class="headerlink" title="WordPress搭建"></a>WordPress搭建</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ sudo rm -rf /usr/share/nginx/html/test-env-website/info.php        &lt;-- 删除用于测试的info.php文件，以防止他人查看本地的php环境数据</span><br><span class="line">testu@bogon:~$ wget https://wordpress.org/latest.tar.gz                           &lt;-- 下载最新版的WordPress</span><br><span class="line">testu@bogon:~$ tar xzvf latest.tar.gz                                             &lt;-- 解压文件</span><br><span class="line">testu@bogon:~$ sudo mv ./wordpress/* /usr/share/nginx/html/test-env-website/      &lt;-- 移动文件到网站目录下</span><br><span class="line">testu@bogon:~$ rm -rf ./wordpress/                                                &lt;-- 删除移走文件后剩下的空目录</span><br><span class="line">testu@bogon:~$ sudo chown -R nginx:nginx /usr/share/nginx/html/test-env-website/  &lt;-- 修改网站目录下全部文件的所有者</span><br></pre></td></tr></table></figure><p>剩下的就是打开网站，按提示一步一步安装WordPress了。放个安装好的截图~</p><p><img src="/images/wordpress-installation-finished.png" alt="WordPress搭建"></p><p>最后说一下，如果遇到错误，可以试着通过Nginx和php的错误日志来尝试确定、解决问题~</p>]]></content>
    
    
    <summary type="html">本文记录了我以WordPress搭建为目的，在Debian 11下进行LEMP/LNMP环境搭建的过程。详细记录了Nginx安装、MySQL/MariaDB安装与PHP安装（包含WordPress所需扩展）的步骤，以及后续的配置过程。</summary>
    
    
    
    <category term="原创" scheme="https://tsz.me/categories/%E5%8E%9F%E5%88%9B/"/>
    
    
    <category term="技术类" scheme="https://tsz.me/tags/%E6%8A%80%E6%9C%AF%E7%B1%BB/"/>
    
  </entry>
  
  <entry>
    <title>Debian 11安装与基本配置</title>
    <link href="https://tsz.me/p/20220511_debian-11-installation-guide.html"/>
    <id>https://tsz.me/p/20220511_debian-11-installation-guide.html</id>
    <published>2022-05-11T12:51:16.000Z</published>
    <updated>2022-05-11T12:51:16.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近我手上有一个基于WordPress的项目要进行开发测试工作。考虑到直接购买云服务器或虚拟主机在线上搭建一个环境出来还需要在备案上花费额外的时间，同时我也不清楚这个项目到底会吃掉多少系统资源，购买服务器时该选择哪种规格，所以我的计划是先在本地的虚拟机上跑项目，等开发完成后再把数据从测试环境直接怼到线上去。这样做可以让客户延缓服务器费用的支出，而我则能在本地留下一个测试环境<del>。打死我都不会说是因为我不想垫付服务器费用的</del>:-)</p><h3 id="主题下的相关文章"><a href="#主题下的相关文章" class="headerlink" title="主题下的相关文章"></a>主题下的相关文章</h3><ul><li>第二篇：<a href="/p/20220512_install-nginx-mariadb-php-lemp-lnmp-stack.html">LEMP&#x2F;LNMP环境搭建（Debian 11）</a></li></ul><h2 id="服务器操作系统的选择"><a href="#服务器操作系统的选择" class="headerlink" title="服务器操作系统的选择"></a>服务器操作系统的选择</h2><h3 id="为什么不选择CentOS"><a href="#为什么不选择CentOS" class="headerlink" title="为什么不选择CentOS"></a>为什么不选择CentOS</h3><p>2020年12月8日，<a href="https://blog.centos.org/2020/12/future-is-centos-stream/">CentOS官方宣布停止维护CentOS</a>，并推出了CentOS Stream项目。</p><p>对比一下Win7你就知道，最迟在2024年6月30日以后，这对于CentOS用户意味着什么。CentOS Stream是一个滚动升级的版本，无法保障系统稳定性与兼容性，所以CentOS Stream并不是生产环境的一个可选方案。</p><h3 id="为什么不选择Ubuntu"><a href="#为什么不选择Ubuntu" class="headerlink" title="为什么不选择Ubuntu"></a>为什么不选择Ubuntu</h3><p>Ubuntu一方面通过其易用性吸引了大量初级用户，另一方面它又轻率不严肃地修改关键代码，造成与其它发行版不兼容的局面。这就导致了初级用户可能会遇到一些其它发行版并没有出现的问题，又或是在遇到其它发行版存在的共同问题时无法获取其它发行版的帮助，初级用户将因此而不得不购买Ubuntu的服务。<del>如果这样说不好理解的话，你可以类比一下，如果核酸检测能让你挣钱的话，你会希望疫情过去吗？</del></p><blockquote><p>我对Ubuntu的看法是：如果将它用作桌面操作系统来使用还行，毕竟GitHub上有很多开源软件的开发者在用Ubuntu进行开发，在相同的环境下开展开发工作可能更好的解决问题。但作为服务器操作系统的话，还是洗洗睡吧。<br>话说回来，Arch Linux具有拥好的wiki文档，想学习Linux的同学放弃Ubuntu桌面转向Arch可能会是更好的选择。</p></blockquote><h3 id="Debian系统简介"><a href="#Debian系统简介" class="headerlink" title="Debian系统简介"></a>Debian系统简介</h3><ul><li>Debian是一个通用操作系统，即它<a href="https://www.debian.org/releases/stable/">支持多种计算机架构</a>；</li><li>Debian以其稳定性闻名（注：但凡说到稳定，就意味着它的套件有可能会是过时的，这些过时的套件只会有必要的安全更新而没有功能更新）；</li><li>Debian主要关注自由和开源软件，<strong>它提供的内核不包括专有驱动程序和固件</strong>；</li><li>Debian是一个真正的社区项目，它由社区成员管理。用户可以在Debian论坛中寻求帮助或提出建议。它没有提供付费支持服务（企业用户想花钱的话就自己养团队吧，提供更多的就业岗位能更好地展现企业的经济实力）。</li></ul><p>Debian一直维护着至少三个发行版：不稳定版（unstable）、测试版（testing）和稳定版（stable）。对每个稳定版，用户可以得到三年的完整支持以及额外两年的长期支持。<strong>当前（2022年5月11日）最新的稳定版是Debian 11.3，代号Bullseye。它在2026年7月结束支持。</strong></p><h2 id="Debian-11安装过程"><a href="#Debian-11安装过程" class="headerlink" title="Debian 11安装过程"></a>Debian 11安装过程</h2><h3 id="光盘镜像选择"><a href="#光盘镜像选择" class="headerlink" title="光盘镜像选择"></a>光盘镜像选择</h3><p>Debian官方提供了<a href="https://www.debian.org/distrib/">3种安装镜像</a>类型，它们分别是：</p><ul><li>普通镜像</li><li>Live版镜像</li><li>云镜像</li></ul><p>其中普通镜像又分为网络安装（netinst）镜像和完整镜像：网络安装镜像只包含了安装基本系统所需的最少软件，剩下的软件包都通过网络进行下载；而完整镜像包含了更多的软件包，以便在无法联网的机器上完成安装。当你点击Debian官网的下载按钮时，它提供的是最小化的网络安装镜像，此镜像没有非开源的固件。<strong>如果你在使用最小化镜像安装系统时遇到网卡或其它硬件无法识别的情况，你需要下载的是另外一个单独包含固件的非自由镜像。</strong></p><p>Live镜像是一个live系统，之所以称它为系统，是因为这个镜像中包含了已预先安装的完整系统。你只需要下载后把它刻录进光盘或者写入到U盘，插入电脑后开机，在BIOS启动选项中选择从光盘或U盘启动，就可以直接进入系统开始工作。这时你并没有安装任何东西到你的硬盘上去，所有的程序都是直接从光盘或U盘上执行的。它非常适合新用户来体验Debian系统。<strong>强烈推荐普通桌面用户选此镜像安装Debian：在新手安装Debian过程中，聪明地采用此镜像，就已经成功一半了。</strong></p><p>云镜像主要用于云服务器的部署。其中适用于OpenStack的qcow2&#x2F;raw格式的镜像可以通过转换来用于VMware虚拟机。</p><p>关于镜像的其他问题，可以访问<a href="https://www.debian.org/CD/faq/index.zh-cn.html">Debian官方常见问答集</a>。</p><p>为了更好的演示安装过程，这次我们不选择通过云镜像来安装，我们选择普通镜像。两种普通镜像在安装过程中几乎没有出入，请根据自己掷出的骰子随意选择。</p><h3 id="安装用的虚拟机环境说明"><a href="#安装用的虚拟机环境说明" class="headerlink" title="安装用的虚拟机环境说明"></a>安装用的虚拟机环境说明</h3><p><img src="/images/debian-11-vmware-setting-1.png" alt="虚拟机资源分配"></p><p><img src="/images/debian-11-vmware-setting-2.png" alt="虚拟机NAT网络默认设置"></p><ul><li>虚拟机软件：VMware Workstation</li><li>虚拟机的CPU分配：1个CPU，2个核心</li><li>虚拟机磁盘大小：20G</li><li>虚拟机的网络连接方式：NAT<del>（默认网段192.168.88.0&#x2F;24，DHCP默认开启）</del></li></ul><h3 id="本文与实体机安装可能存在的差异"><a href="#本文与实体机安装可能存在的差异" class="headerlink" title="本文与实体机安装可能存在的差异"></a>本文与实体机安装可能存在的差异</h3><p>本文是基于虚拟机安装Debian书写的。实体机的安装可能存在差异：</p><ul><li>虚拟机直接通过iso文件启动，而现实中你需要将iso通过<a href="https://rufus.ie/zh/">Rufus</a>（Windows平台）或<a href="https://www.balena.io/etcher/">Etcher</a>（Windows&#x2F;Linux平台）工具制成启动U盘，并需要进行一些设置操作来完成通过U盘来启动电脑；</li><li>虚拟机在没有操作系统的时候会直接通过iso启动，而现实中你可能需要在电脑开机显示制造商标识的时候，按下<code>F2</code>、<code>F10</code>或<code>F12</code>等键进入开机引导设置界面（不同的的制造商在按键和界面上会有一些差异）；</li><li>有些实体机启用了安全启动（secure boot）功能，它不允许引导Linux安装光盘。如果是这种情况，请<a href="https://itsfoss.com/disable-secure-boot-windows/">从BIOS设置里禁用安全启动</a>；</li><li><del>在实体机上进行安装，你可能还需要额外了解一些<a href="https://itsfoss.com/check-mbr-or-gpt/">MBR与GPT</a>、<a href="https://itsfoss.com/check-uefi-or-bios/">传统的BIOS与UEFI</a>的知识；</del></li><li><strong>实体机安装Debian，请优先选用Live镜像，请优先选用Live镜像，请优先选用Live镜像。重要的事情说三遍。</strong></li></ul><h3 id="详细安装记录"><a href="#详细安装记录" class="headerlink" title="详细安装记录"></a>详细安装记录</h3><p><img src="/images/debian-11-installer-menu.png" alt="Debian 11 installer menu"></p><p>从镜像启动虚拟机，进入安装选项界面。前两个选项分别是图形化安装（Graphical install）和终端安装（Install），它们的安装步骤都是类似的。在终端下安装无法使用鼠标进行操作，推荐新人选择图形化安装。</p><p><img src="/images/debian-11-installation-choose-language.png" alt="语言选择"></p><p>接下来是语言选择界面，这个语言选择控制的不只是安装过程中界面上显示的文字，也是操作系统安装完成后默认的系统语言。因为我是把它作为服务器来使用的，安装后并没有图形界面，都是在命令行下执行操作的，而在直连的终端下使用中文可能会有显示问题（SSH连接的话应该是没有问题的），所以为了不在安装完成后重新进行设置，我在这里选择了默认的English。<strong>新手可以选择中文，不用担心，系统安装完成后是可以修改语言的。毕竟弄明白是怎么回事儿更重要。</strong></p><p><img src="/images/debian-11-installation-choose-location-1.png" alt="地域选择 - other"></p><p><img src="/images/debian-11-installation-choose-location-2.png" alt="地域选择 - Asia"></p><p><img src="/images/debian-11-installation-choose-location-3.png" alt="地域选择 - China"></p><p>接下来是选择地域，这一步会影响到后面安装源的选择，为了加快源的下载速度，可以根据服务器的实际位置来选择。这里我选择other-Asia-China。</p><p><img src="/images/debian-11-installation-choose-locales.png" alt="系统本地化设置"></p><p>这里需要对系统的本地化进行额外的设置。由于我们前面选择的是使用English语言，位置在China，而系统里面没有自带en_CN.UTF-8这个选项，所以需要我们自己选择一个合适的选项。默认选择的en_US.UTF-8就很OK。</p><p><img src="/images/debian-11-installation-keyboard-keymap.png" alt="键盘布局选择"></p><p>键盘布局选择，如果键盘上按键位置与其他国内到处可见的键盘一致，选择默认的American English即可。</p><p><img src="/images/debian-11-installation-hostname.png" alt="主机名设置"></p><p>主机名设置，它的作用是在局域网中标识你的主机（就好像在互联网中使用域名来标识一台服务器一样）。由于这是一台本地测试服务器，不需要什么公司统一的命名规范，随便起一个能让自己快速明白它的作用，且与网络中其它主机不重复的名称即可。</p><p><img src="/images/debian-11-installation-domain.png" alt="域名设定"></p><p>主机域名设定。我们的电脑只是用于家庭网络，所以随便选个名字就行。这里采用系统默认的名称localdomain。</p><p>注：因为我们把虚拟机的网络设置成了NAT，虚拟机所在的网络是有DHCP服务器的，所以这里你看到的情况可能会和你实际操作中遇到的界面不太一样，这里是因为Debian安装程序会自动检测主机连接的网络情况，自动配置了网络参数。</p><p><img src="/images/debian-11-installation-root-password.png" alt="管理员密码设置"></p><p>设置管理员用户root的密码，连续输入两次。</p><p><img src="/images/debian-11-installation-create-user.png" alt="添加新用户"></p><p>除了root之外，我们还需要为系统添加一个普通用户，这里我们要输入的是用户全名。注意，这不是用户登录系统使用的用户名。就好像现实中有一个人名字叫张三，他电脑登陆的用户名却叫luoxiang。这里输入的是他自己喜欢的名字：张三，或者法外狂徒。</p><p><img src="/images/debian-11-installation-user-account.png" alt="设置新用户登陆名"></p><p>为刚刚我们新建的用户指定一个登陆系统使用的用户名。因为Debian安装之后默认不允许使用root进行SSH登录，在创建别的用户之前，这里创建的新用户是唯一能通过SSH登录的用户，请务必牢记当前创建的登陆名和密码。</p><p><img src="/images/debian-11-installation-user-password.png" alt="设置新用户登陆密码"></p><p>为新用户指定登陆系统使用的密码，重复两次。</p><p><img src="/images/debian-11-installation-partition-1.png" alt="磁盘分区"></p><p>这一步是磁盘分区。这里要进行的操作可能会稍微专业那么一丢丢。很多对Linux不熟悉的朋友在物理机安装Linux的时候导致硬盘分区丢失就是在这一步。不过我们选择知难而退，直接让系统帮我们把整个磁盘（entire disk）进行分区。分区的时候我们选择第二个选项，使用LVM。</p><p>LVM是Logical Volume Manager的缩写，中文一般翻译为“逻辑卷管理”，它是Linux下对磁盘分区进行管理的一种机制。系统管理员可以利用LVM<strong>在不重新对磁盘分区的情况下动态的调整分区的大小</strong>。如果系统新增了一块硬盘，通过LVM就可以将新增的硬盘空间直接扩展到原来的磁盘分区上。例如：未来我们觉得之前分配给系统的磁盘小了不够用了，我们可以直接通过VMware添加一块磁盘给虚拟机，再通过一系列指令来扩大原来分配的磁盘大小。</p><p><strong>如果是在虚拟机中来为现实安装做练习，你可以尝试下第四个选项，手动配置。练习前可以看看<a href="http://cn.linux.vbird.org/linux_basic/0130designlinux.php">鸟哥的文档-主机规划与磁盘分区</a>。</strong></p><p><img src="/images/debian-11-installation-partition-2.png" alt="选择分区磁盘"></p><p>给系统解释一下，我们说的整块磁盘，到底是哪块磁盘。「你给我翻译翻译，什么他妈的是他妈的惊喜」</p><p><img src="/images/debian-11-installation-partition-3.png" alt="自动分区策略"></p><p>这里是指定一个自动分区的策略，我们是否要把一些挂载点单独分出来。单独分出来的话，在<strong>现实中</strong>是有好处的，如果硬盘出现问题，你可以把这些分区单独挂载出来，执行导数据等一系列操作。我们当前的出发点是做测试环境，实际借助的是VMware的快照功能。我们实际需要做的是加强我们本地实体机的硬盘抗灾能力，而非虚机。所以这里我们大胆的选择，请把全部文件放在一个分区下——我是Python用户，一个采取扁平化方式看待世界的人。</p><p><img src="/images/debian-11-installation-partition-4.png" alt="硬盘分区动作确认"></p><p>吃红色药丸（Yes），还是吃蓝色药丸（No）？选择了Yes，硬盘上的数据就要说拜拜了您呐。选择了No，过会儿它再来问你一次。</p><p>Debian默认使用ext4文件系统。ext4是什么，你可以参照Windows使用NTFS格式对磁盘进行格式化这个概念来进行对比理解。</p><p><img src="/images/debian-11-installation-partition-5.png" alt="卷组大小设置"></p><p>确认一下卷组大小。默认值（整个磁盘大小）即可。</p><p><img src="/images/debian-11-installation-partition-6.png" alt="LVM执行确认"></p><p>再确认一下，确认后系统就要搞事儿了。<a href="https://zh.wikipedia.org/zh-cn/%E5%8B%BF%E8%AC%82%E8%A8%80%E4%B9%8B%E4%B8%8D%E9%A0%90%E4%B9%9F">勿谓言之不预也</a>~</p><p><img src="/images/debian-11-installation-base-system.png" alt="基础系统安装"></p><p>安装最小系统。等待读条。</p><p><img src="/images/debian-11-installation-apt-1.png" alt="扫描其他安装光盘"></p><p>是否还有其它的安装光盘？因为后续我们会通过网络来下载所需的软件包，所以此处我们选No。如果对这一步有疑问，请留言。</p><p><img src="/images/debian-11-installation-apt-2.png" alt="选择距离您最近的本地镜像源"></p><p>选择你要使用的本地镜像源，请选择距离你位置最近的地区。这里选了China。</p><p><img src="/images/debian-11-installation-apt-3.png" alt="本地镜像源选择"></p><p>我选择163镜像源。</p><p><img src="/images/debian-11-installation-apt-4.png" alt="代理设置"></p><p>你上网是否需要使用代理？不需要的留空。</p><p><img src="/images/debian-11-installation-apt-5.png" alt="APT包管理器配置读条"></p><p>配置APT包管理器。等读条……</p><p><img src="/images/debian-11-installation-usage-survey.png" alt="使用反馈选项"></p><p>是否参加匿名的使用反馈？你决定。</p><p><img src="/images/debian-11-installation-software.png" alt="软件安装选择"></p><p>选择需要安装的软件包。我们是服务器用途，所以我们就不安装桌面环境了（毕竟我只给它分配了2G的内存，要啥自行车！这是任性的时候么，都要是资源的）。但是我们要远程使用SSH工具登陆系统，所以我们选择SSH Server选项。最后一项——标准的系统工具集——我们继续保持默认选中状态。</p><p><img src="/images/debian-11-installation-grub-1.png" alt="安装引导"></p><p>是否在本地磁盘上安装引导。我们本机没有别的操作系统安装的引导程序，也不想每次通过光盘来引导系统启动，所以这一步我们选择Yes。</p><p><img src="/images/debian-11-installation-grub-2.png" alt="安装引导"></p><p>选择把引导安装在哪块磁盘上。我只且仅有一块硬盘，所以直接选择&#x2F;dev&#x2F;sda。第一个选项是手工输入，需要自己手敲键盘，敲的内容还是<code>/dev/sda</code>，会多消耗8次键盘敲击的能量。现实中用户如果想实现Windows-Linux双系统共存，可以先安装Windows再安装Linux，这样可能会在引导程序这个问题上减少工作量。不过如果只有一块磁盘又想双系统，那之前的分区操作就需要你多花点时间来深入了解一下，毕竟不能再任性地擦除整块硬盘数据了。</p><p><img src="/images/debian-11-installation-grub-3.png" alt="安装引导"></p><p><img src="/images/debian-11-installation-complete.png" alt="Debian 11 installation complete"></p><p>完成安装，系统要求移除光盘后重启——不移除光盘的话，如果系统还是从光盘引导而不是硬盘引导的话，会再次进入系统安装过程。不过VMware会在重启后尝试从磁盘启动系统的，所以我们在此并不需要实际做些什么。直接Continue。</p><p><img src="/images/debian-11-installation-finish.png" alt="完成安装"></p><p>系统重启，安全地看到系统启动引导界面。泪流满面。</p><h2 id="Debian-11安装后的基本配置"><a href="#Debian-11安装后的基本配置" class="headerlink" title="Debian 11安装后的基本配置"></a>Debian 11安装后的基本配置</h2><h3 id="root无法通过SSH登录"><a href="#root无法通过SSH登录" class="headerlink" title="root无法通过SSH登录"></a>root无法通过SSH登录</h3><p>在新完成安装的Debian系统上，root用户是无法直接通过SSH登录的，我们只能通过在安装过程创建的用户进行SSH的登录（这里说的是SSH远程登陆，不是直接在电脑前操作。在电脑前root用户可以直接登陆）。</p><p>如果希望root用户登陆SSH的话，需要修改SSH的配置文件。实际上不以root用户直接登陆系统可能是更安全的选项，而且在有需要的时候可以通过<a href="http://cn.linux.vbird.org/linux_basic/0410accountmanager_4.php">身份变换</a>的方式来运行指令。所以我们在此就不设置允许root SSH登陆了。</p><h3 id="sudo命令找不到"><a href="#sudo命令找不到" class="headerlink" title="sudo命令找不到"></a>sudo命令找不到</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ su -                      &lt;--切换到root用户，并加载root用户的环境变量！</span><br><span class="line">Password:                                &lt;-- 输入root的密码</span><br><span class="line">root@bogon:~# apt install sudo           &lt;-- 执行sudo的安装</span><br><span class="line">root@bogon:~# sudo -V | grep path        &lt;-- 确定sudoers文件位置</span><br><span class="line">root@bogon:~# cat /etc/sudoers           &lt;-- 查看系统默认的可执行sudo指令的用户群组</span><br><span class="line">root@bogon:~# id testu                   &lt;-- 查看testu用户当前所在的群组</span><br><span class="line">root@bogon:~# usermod -a -G sudo testu   &lt;-- 给testu用户加入sudo群组</span><br><span class="line">root@bogon:~# id testu                   &lt;-- 验证testu用户成功加入群组</span><br><span class="line">root@bogon:~# exit                       &lt;-- 退出root切换</span><br><span class="line">testu@bogon:~# exit                      &lt;-- 退出testu后重新登陆testu，即可拥有sudo权限</span><br></pre></td></tr></table></figure><h3 id="执行系统更新"><a href="#执行系统更新" class="headerlink" title="执行系统更新"></a>执行系统更新</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ sudo apt update   &lt;-- 检查更新</span><br><span class="line">[sudo] password for testu:       &lt;-- 输入的是testu的密码，而不是执行su时输入的root密码</span><br><span class="line">testu@bogon:~$ sudo apt upgrade  &lt;-- 执行更新（如果有更新的话再执行）</span><br><span class="line">testu@bogon:~$ man sources.list  &lt;-- 查看如何配置软件源的系统手册</span><br><span class="line">testu@bogon:~$ cat /etc/apt/sources.list   &lt;-- 系统软件源配置文件，如有deb cdrom的条目可以在此文件中使用sudo vi /etc/apt/sources.list命令来编辑注释该行</span><br></pre></td></tr></table></figure><h3 id="设定命令alias"><a href="#设定命令alias" class="headerlink" title="设定命令alias"></a>设定命令alias</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ alias                            &lt;-- 查看当前已有的命令alias</span><br><span class="line">testu@bogon:~$ cat /etc/shells                  &lt;-- 查看当前系统有哪些shell可用</span><br><span class="line">testu@bogon:~$ cat /etc/passwd | grep `whoami`  &lt;-- 查看自己账号使用的shell</span><br><span class="line">testu@bogon:~$ man bash                         &lt;-- 当前我用的是bash，看一下帮助手册</span><br><span class="line">testu@bogon:~$ cat ~/.bashrc                    &lt;-- 查看~/.bashrc文件</span><br><span class="line">testu@bogon:~$ vi ~/.bashrc                     &lt;-- 编辑此文件，在此处取消一些alias注释</span><br><span class="line">testu@bogon:~$ source ~/.bashrc                 &lt;-- 重新加载~/.bashrc使修改生效</span><br><span class="line">testu@bogon:~$ alias                            &lt;-- 可以确认新设置的alias已经生效了</span><br><span class="line">testu@bogon:~$ cat /etc/bash.bashrc             &lt;-- 这里只是告诉你这是系统全局的bashrc</span><br></pre></td></tr></table></figure><h3 id="系统防火墙配置"><a href="#系统防火墙配置" class="headerlink" title="系统防火墙配置"></a>系统防火墙配置</h3><p>nftables是Debian 11默认的防火墙，它替换了之前使用的iptables。系统安装完后，防火墙是默认没有启用的。<strong>直接启用后里边也是没有默认规则的。</strong>由于我是测试用途，所以就不配置防火墙了。</p><p>下面放置一些基本资料，有需要的朋友请自行研究或者留言告诉我。有需要的人多了，我再出个文档。</p><p>官方wiki：<a href="https://wiki.debian.org/nftables">https://wiki.debian.org/nftables</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">testu@bogon:~$ systemctl status nftables          &lt;-- 查看防火墙状态</span><br><span class="line">testu@bogon:~$ cat /etc/nftables.conf             &lt;-- 查看当前防火墙的配置</span><br><span class="line">testu@bogon:~$ sudo systemctl start nftables      &lt;-- 开启防火墙</span><br><span class="line">testu@bogon:~$ sudo nft list ruleset              &lt;-- 查看当前的防火墙规则</span><br><span class="line">testu@bogon:~$ sudo systemctl enable nftables     &lt;-- 设置开机启动</span><br></pre></td></tr></table></figure><h3 id="其他学习资料"><a href="#其他学习资料" class="headerlink" title="其他学习资料"></a>其他学习资料</h3><p>想要更好地学习Debian，可参考<a href="https://www.debian.org/doc/manuals/debian-reference/">Debian参考手册</a>。请<strong>不要</strong>盲目追求系统性的学习，立足于遇到的每一个实际问题，坚持上手实践就会有巨大进步的。</p>]]></content>
    
    
    <summary type="html">手把手保姆级的Debian 11安装教程。逐步演示如何使用Debian 11的普通镜像进行Debian 11的安装，并在安装完成后对系统进行一些基本的易用性配置，如添加sudo，配置alias等。</summary>
    
    
    
    <category term="原创" scheme="https://tsz.me/categories/%E5%8E%9F%E5%88%9B/"/>
    
    
    <category term="技术类" scheme="https://tsz.me/tags/%E6%8A%80%E6%9C%AF%E7%B1%BB/"/>
    
  </entry>
  
  <entry>
    <title>《卡片笔记写作法》阅读与实践</title>
    <link href="https://tsz.me/p/20211007_%E3%80%8A%E5%8D%A1%E7%89%87%E7%AC%94%E8%AE%B0%E5%86%99%E4%BD%9C%E6%B3%95%E3%80%8B%E9%98%85%E8%AF%BB%E4%B8%8E%E5%AE%9E%E8%B7%B5.html"/>
    <id>https://tsz.me/p/20211007_%E3%80%8A%E5%8D%A1%E7%89%87%E7%AC%94%E8%AE%B0%E5%86%99%E4%BD%9C%E6%B3%95%E3%80%8B%E9%98%85%E8%AF%BB%E4%B8%8E%E5%AE%9E%E8%B7%B5.html</id>
    <published>2021-10-07T04:27:02.000Z</published>
    <updated>2021-10-17T04:30:05.878Z</updated>
    
    <content type="html"><![CDATA[<p>通过理解书中说明并按其观点进行实践，我发现这样一个问题，我没必要写出这篇文章（《卡片笔记写作法》阅读与实践）……我需要重新确定这篇文章的书写方向。</p><p>是否具有看待笔记的正确姿势，会直接影响卡片笔记写作法能否有效落地。我没法跳过说明如何看待笔记才是正确的，而直接推动实践。正确的看待笔记并不是一篇文章能够说清楚的，要不然作者也不会整本书去写它。</p><p>所以这本书需要你自己去看，自己去实践。我这篇文章是蛋疼的。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;通过理解书中说明并按其观点进行实践，我发现这样一个问题，我没必要写出这篇文章（《卡片笔记写作法》阅读与实践）……我需要重新确定这篇文章的书写方向。&lt;/p&gt;
&lt;p&gt;是否具有看待笔记的正确姿势，会直接影响卡片笔记写作法能否有效落地。我没法跳过说明如何看待笔记才是正确的，而直接推</summary>
      
    
    
    
    <category term="c_生活" scheme="https://tsz.me/categories/c-%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="读书" scheme="https://tsz.me/tags/%E8%AF%BB%E4%B9%A6/"/>
    
  </entry>
  
  <entry>
    <title>微信小程序</title>
    <link href="https://tsz.me/p/20210913_%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F.html"/>
    <id>https://tsz.me/p/20210913_%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F.html</id>
    <published>2021-09-13T05:28:02.000Z</published>
    <updated>2021-09-13T05:28:02.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="开发环境搭建"><a href="#开发环境搭建" class="headerlink" title="开发环境搭建"></a>开发环境搭建</h2><p>照<a href="https://www.ruanyifeng.com/blog/2020/10/wechat-miniprogram-tutorial-part-one.html">微信小程序入门教程之一：初次上手</a>文章操作。文章读取顺序为7，4，5，8，6，1，2，3。</p><p>基础环境搭建完毕。效果如图：</p><p><img src="/images/QQ20210913135942.png" alt="世界不会变好的"></p><h2 id="基础知识点了解"><a href="#基础知识点了解" class="headerlink" title="基础知识点了解"></a>基础知识点了解</h2><p><a href="https://www.ruanyifeng.com/blog/2020/10/wechat-miniprogram-tutorial-part-two.html">微信小程序入门教程之二：页面样式</a>这篇：</p><ul><li>第一节：.wxss文件就是小程序的CSS样式；</li><li>第二节：讲了<del>Flex布局（暂时不做更多了解）、</del> 小程序屏幕的宽度为750rpx、justify-content和align-items；</li><li>第三节：介绍了腾讯<a href="https://github.com/Tencent/weui">WeUI</a>和它的使用方法、<a href="https://github.com/Tencent/weui-wxss">weui-wxss</a>；</li><li>剩下的跳过。</li></ul><p>&#x2F;*</p><p>网上随便找一个支持小程序的开源项目，对比weui-wxss开始搞事情。</p><p>扩展阅读：</p><ul><li><a href="http://www.wxappclub.com/topic/583">小程序基础篇之使用weui.wxss</a></li><li><a href="https://www.cnblogs.com/jing-zhe/p/11000971.html">微信小程序weui的使用</a></li><li><a href="https://developers.weixin.qq.com/community/develop/article/doc/000e427c49c218e6b9781bfdf5b013">你想在小程序里使用less嘛? （VScode版）</a></li><li><a href="https://less.bootcss.com/">Less快速入门</a></li></ul><p>产生以下疑问：</p><ol><li>weui-wxss到底干了啥？</li></ol><p>界面搞的差不多了，继续向下。</p><p>*&#x2F;</p><p><a href="https://www.ruanyifeng.com/blog/2020/10/wechat-miniprogram-tutorial-part-three.html">微信小程序入门教程之三：脚本编程</a>这篇：</p><ul><li>第一节：MVVM模式和数据绑定，即数据写在JS里面，前台用<code>&#123;&#123;变量名&#125;&#125;</code>引用；</li><li>第二节：globalData属性可以用来存放全局数据；</li><li>第三节：微信小程序事件模型，如何绑定事件；</li><li>第四节：<code>wx</code>是小程序提供的原生对象，所有客户端 API 都定义在这个对象上面；</li><li>第五节：如果第四节讲的是js的alert，那这节就是js的confirm&#x2F;prompt。</li></ul><p><a href="https://www.ruanyifeng.com/blog/2020/11/wechat-miniprogram-tutorial-part-four.html">微信小程序入门教程之四：API 使用</a>这篇：</p><ul><li>第一节：你知道有<code>wx:for</code>这类属性的存在就好（写jsp的应该都懂）；</li><li>第三节：<strong>与服务器交换数据</strong>，<a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html">官方文档</a>；</li><li>第四节：无需授权、登录的<code>&lt;open-data&gt;</code>标签；</li><li>第五节：<del>获取不能唯一标识用户的个人信息（不能标识用户就球用没有）</del>；</li><li>第六节：微信小程序的a标签<code>&lt;navigator&gt;</code>；</li><li>第七节：用脚本进行跳转时使用<code>wx.navigateTo()</code>；</li><li>第二节：微信的本地存储功能。</li></ul><p>&#x2F;&#x2F; 基础知识到这里就结束了。打开PyCharm继续搞事。</p><h2 id="实际开发中遇到的问题"><a href="#实际开发中遇到的问题" class="headerlink" title="实际开发中遇到的问题"></a>实际开发中遇到的问题</h2><h3 id="如何获取-openID？"><a href="#如何获取-openID？" class="headerlink" title="如何获取 openID？"></a>如何获取 openID？</h3><p><a href="https://developers.weixin.qq.com/community/develop/article/doc/00082a04b94c00a9f3eb879ba5ac13">微信小程序获取openID及unionID</a>说明的比较详细：</p><ol><li>需要在微信小程序调用登录开放接口<a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html">wx.login()</a>获取用户登陆凭证code；</li><li>向服务器发送请求，并将code一起发送过去；</li><li>接下来，在服务端调用<a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/login/auth.code2Session.html">auth.code2Session接口</a>；</li><li>接口返回openid。</li></ol><p>这篇文章还说明，只想拿到openID的我良心大大的好。unionID未来也要拿。</p><p>其他参考文档：</p><ul><li><a href="https://www.jianshu.com/p/4e9cd99ecbf5">var、let、const 区别？</a></li><li><a href="https://www.jianshu.com/p/254812c8cca2">JavaScript ES6 规范</a> - 没细看</li></ul><h3 id="onLoad方法到底被调用了几次？"><a href="#onLoad方法到底被调用了几次？" class="headerlink" title="onLoad方法到底被调用了几次？"></a>onLoad方法到底被调用了几次？</h3><p>参考文档（同时打开的，未经过筛选）：</p><ul><li><a href="https://developers.weixin.qq.com/community/develop/doc/0004aa392e88084f4a99a45fb5b000">onload和onshow什么区别?</a></li><li><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/page.html">注册页面 | 微信开放文档</a></li><li><a href="https://blog.csdn.net/ljy950914/article/details/91384311">微信小程序onLoad、onShow、onHide、onUnload区别</a></li><li><a href="https://m.yisu.com/zixun/191221.html">微信小程序中的onLoad详解及简单实例</a></li></ul><p><strong>待验证。</strong></p><h3 id="小程序-lt-view-gt-标签如何换行？"><a href="#小程序-lt-view-gt-标签如何换行？" class="headerlink" title="小程序&lt;view&gt;标签如何换行？"></a>小程序&lt;view&gt;标签如何换行？</h3><p>参考文档：</p><ul><li><a href="http://www.lrxin.com/archives-1241.html">微信小程序 文本换行 实现转义&#x2F;n 换行符</a></li><li><a href="https://blog.csdn.net/Dorothy1224/article/details/104316229">微信小程序换行 br 无效解决方法</a></li></ul><p><del>我采用添加&lt;text&gt;标签的方法。</del></p><p>直接看下面的<code>小程序如何显示HTML</code>，这样还能实现字体加粗等功能。</p><h3 id="小程序如何多真机调试？"><a href="#小程序如何多真机调试？" class="headerlink" title="小程序如何多真机调试？"></a>小程序如何多真机调试？</h3><p>参考文档：</p><ul><li><a href="https://developers.weixin.qq.com/community/develop/doc/00084ef40e46f03e88a8857765b800">真机调试支持多个微信测试吗</a></li><li><a href="https://developers.weixin.qq.com/community/develop/article/doc/00062e21318b48972baac499056813">小程序如何在真机调试</a></li></ul><p><strong>验证结果：找不到权限配置的地方。</strong> 问题未解决。</p><h3 id="小程序如何显示HTML？"><a href="#小程序如何显示HTML？" class="headerlink" title="小程序如何显示HTML？"></a>小程序如何显示HTML？</h3><p>参考文档：</p><ul><li><a href="https://developers.weixin.qq.com/community/develop/doc/ec946412e4516d9fce18fd0ee8abb45a">HTML内容如何在小程序显示？</a></li><li><a href="https://developers.weixin.qq.com/miniprogram/dev/component/rich-text.html">rich-text | 微信开放文档</a> - 采用此方法</li><li><del><a href="https://www.shuzhiduo.com/A/RnJWBqZYzq/">支付宝小程序开发——rich-text富文本组件支持html代码</a></del></li><li><del><a href="https://blog.csdn.net/weixin_44326007/article/details/103277401">微信小程序显示HTML富文本</a> - 使用的wxParse已停止维护</del></li><li><a href="https://segmentfault.com/q/1010000015789986/a-1020000016005596">微信小程序使用rich-text和wxparse解析富文本的区别</a> - 这篇文章提供了另外的思路（web-view）</li><li><a href="https://www.cnblogs.com/wxw1314/p/7929633.html">微信小程序实现给循环列表点击添加类（单项和多项）</a> - 提供了比官方更实用的例子</li><li><del><a href="https://developers.weixin.qq.com/community/develop/doc/00024cabb380a00db48cbe5fb51000?jumpto=comment&commentid=000600f21a42a86db88c29ba4564?source=indexmixflow">双重for循环中内部循环text前后都多出一行，为啥啊？我裂开了</a> - 对我没用，存档链接而已</del></li><li><a href="https://blog.csdn.net/sinat_15955423/article/details/100081646">小程序循环解析富文本数据</a> - <code>跟vue的v-html一样</code>，备忘改天了解下v-html</li><li><strong><a href="https://github.com/sbfkcel/towxml">……</a></strong></li><li><a href="https://segmentfault.com/a/1190000012250564">关于微信小程序webview的使用</a> - <del>web-view不支持支付能力。（可变相实现）</del> 文章中提到了<code>jssdk</code></li><li><a href="https://developers.weixin.qq.com/community/develop/article/doc/00044eb007c2c8dd1509a4e1656413">小程序webview组件，小程序和webview交互，小程序内联h5页面，小程序webview内网页实现微信支付</a> - 我当前并不需要支付能力。我只是想让大家看看文档的标题可以有多长……</li><li><a href="https://juejin.cn/post/6899426534239682568">喂汁，用Python写个专属Markdown转换工具</a> - 当前我服务端使用的python-markdown不能满足需求，考察下其他类库</li><li><a href="https://www.cnblogs.com/harrylyx/p/12395259.html">Mistune——更快的markdown解析器</a></li><li><a href="https://www.chancel.ltd/articles/72">Python Markdown解析器Mistune使用指南</a> - 这个博客的样式看着挺顺眼</li><li><a href="https://github.com/zdxerr/mistune-latex">zdxerr&#x2F;mistune-latex</a> - 恩……7年前的代码</li><li><a href="https://mistune.readthedocs.io/en/latest/">Mistune: Python Markdown Parser</a> - 2.0rc的Mistune貌似有些新功能</li><li><a href="https://juejin.cn/post/6844904035271573511">手把手带你入门 AST 抽象语法树</a></li><li><a href="https://zhuanlan.zhihu.com/p/266697614">AST详解与运用</a></li></ul><p>官方虽然<code>不推荐使用String类型，性能会有所下降</code>，但是搬砖效率啊。我选String。</p><p>到此，也该学会如何使用官方文档了。</p><p>之所以不使用web-view，是因为我是个人开发者，不是公司。</p><h3 id="小程序页面跳转应采取哪种方法（页面之间如何传参）（如何在跳转后返回上一级）？"><a href="#小程序页面跳转应采取哪种方法（页面之间如何传参）（如何在跳转后返回上一级）？" class="headerlink" title="小程序页面跳转应采取哪种方法（页面之间如何传参）（如何在跳转后返回上一级）？"></a>小程序页面跳转应采取哪种方法（页面之间如何传参）（如何在跳转后返回上一级）？</h3><p>参考文档：</p><ul><li><a href="https://blog.csdn.net/zull_kos_mos/article/details/80595828">小程序页面跳转的几个方法和区别</a></li><li><a href="https://www.cnblogs.com/ll15888/p/11813027.html">微信小程序页面跳转区别总结</a></li><li><a href="https://www.jianshu.com/p/19f1cab9c0e2">小程序几个页面跳转的区别</a></li><li><a href="https://blog.csdn.net/xushilong0812/article/details/109757122">微信小程序页面跳转&#x2F;返回</a> - 跳转后如何返回</li></ul><p>根据实际应用挑选合适的方法。</p><h3 id="如何为小程序不同的页面设置标题？"><a href="#如何为小程序不同的页面设置标题？" class="headerlink" title="如何为小程序不同的页面设置标题？"></a>如何为小程序不同的页面设置标题？</h3><p>参考文档：</p><ul><li><a href="https://www.jianshu.com/p/7b06d19fd7a0">小程序之修改页面标题</a></li><li><a href="https://developers.weixin.qq.com/community/develop/doc/0000ea140ec9b01cdc283eae651800">小程序页面标题</a></li></ul><p>这个容易。</p><h3 id="小程序是否有大小的限制？"><a href="#小程序是否有大小的限制？" class="headerlink" title="小程序是否有大小的限制？"></a>小程序是否有大小的限制？</h3><p>参考文档：</p><ul><li><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages.html">分包加载 | 微信开放文档</a> - 简单的说，就是2M限制</li><li><a href="https://developers.weixin.qq.com/community/develop/doc/00002e3056c9203fbf9a15d4e5bc00">小程序包超过大小限制？</a> - 在<code>开发者工具&gt;详情&gt;基本信息&gt;本地代码</code>中查看代码包大小</li></ul><h3 id="textarea如何取值？"><a href="#textarea如何取值？" class="headerlink" title="textarea如何取值？"></a>textarea如何取值？</h3><p>参考文档：</p><ul><li><a href="https://one-more-tech.gitlab.io/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8Ftextarea%E5%8F%96%E5%80%BC%E3%80%81value%E5%90%8C%E6%AD%A5%E3%80%81fixed-input-%E8%A2%AB%E9%94%AE%E7%9B%98%E9%81%AE%E7%9B%96%E7%AD%89%E9%97%AE%E9%A2%98/index/">微信小程序textarea取值、value同步、fixed input 被键盘遮盖等问题</a></li><li><a href="https://www.yisu.com/zixun/374754.html">微信小程序组件textarea多行输入框的示例分析</a> - 暂时没有用到</li><li><a href="https://www.cnblogs.com/At867604340/p/12112175.html">微信小程序获取多个input和textarea的值（es6加微信小程序APi）</a> - 这个是主要的</li><li><a href="https://www.jianshu.com/p/ee6b297eb6c3">wx:for的使用</a></li><li><a href="https://blog.csdn.net/sdfujichao/article/details/80251531">微信小程序-textarea获取输入值（在modal中获取值）</a></li><li><a href="https://developers.weixin.qq.com/community/develop/doc/5d39f76fa8af76f7078dd913e1795acd">小程序textarea组件字数限制问题</a></li><li><a href="https://developers.weixin.qq.com/community/develop/article/doc/0002a6fbcac9a82dbfdaeb78c5b813">微信小程序this.setData如何修改对象、数组中的值</a></li><li><a href="https://segmentfault.com/q/1010000008151383">微信小程序：如何用setData修改数组？</a></li><li><a href="https://blog.csdn.net/u013751625/article/details/80826146">微信小程序如何让多个button绑定同一个事件而区分button</a></li><li><a href="https://blog.csdn.net/Nefertari_YinC/article/details/83009083">小程序View或button点击响应方法的数据传值</a></li></ul><h3 id="如何查看别的小程序源码？"><a href="#如何查看别的小程序源码？" class="headerlink" title="如何查看别的小程序源码？"></a>如何查看别的小程序源码？</h3><p>参考文档：</p><ul><li><a href="https://zhuanlan.zhihu.com/p/138936448">只需两步获取任何小程序源码</a></li><li><a href="https://blog.csdn.net/ZhaoWMian/article/details/105074836">如何获取别人微信小程序的源文件？</a></li><li><a href="https://developers.weixin.qq.com/community/develop/doc/0006448bc706a00fe9472eb9a5e400">官方怎么看？只需两步获取任何微信小程序源码</a></li><li><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/user-encryptkey.html">小程序加密网络通道 | 微信开放文档</a></li><li><a href="https://developers.weixin.qq.com/community/develop/article/doc/000aca16c544f89485297d7aa58413">小程序请求数据双向混合加密和防篡改+防重放攻击的实现</a></li><li><a href="https://www.jianshu.com/p/4b136750bdea">小程序接口加密</a></li><li><a href="https://developers.weixin.qq.com/community/develop/doc/0004c2c3e08070596abaaccfe5bc00">小程序代码怎么做加密？</a> - 里面提到了个uniapp的东西</li></ul><p>首先可以确定的是，可以获取到他人的小程序源码。<strong>暂未实践操作。</strong></p><p>同样的，作者除了混淆代码外，也没有什么保护自己代码的手段。</p><h3 id="picker组件怎样实现自动弹出？"><a href="#picker组件怎样实现自动弹出？" class="headerlink" title="picker组件怎样实现自动弹出？"></a>picker组件怎样实现自动弹出？</h3><p>参考文档：</p><ul><li><a href="https://developers.weixin.qq.com/community/develop/doc/d555284dfad9f1d44ec2b5dd9ffa7c27">picker 组件是否考虑添加自动弹出的选项</a> - 2017.11.1 文档</li><li><a href="https://developers.weixin.qq.com/community/develop/doc/0006ec2ceb0cb08e5167f3e5e56800">picker 手动控制显示与隐藏，望官方能尽快处理。</a> - 2018.9.21 文档</li><li><a href="https://developers.weixin.qq.com/community/develop/doc/0004ca9361c3806128b9e184251c00">picker 组件需要用户触发才能弹窗出来，能否支持接口设置隐藏，显示？</a> - 2020.1.2 文档</li></ul><p>结论：<strong>无法实现这个要求。</strong></p><h3 id="其他不分类的搜索结果"><a href="#其他不分类的搜索结果" class="headerlink" title="其他不分类的搜索结果"></a>其他不分类的搜索结果</h3><p>&#x2F;&#x2F; wx:key 是干什么的</p><ul><li><a href="https://www.cnblogs.com/chenzhiran/p/11160702.html">微信小程序wx:key以及wx:key&#x3D;” *this”详解</a></li></ul><p>&#x2F;&#x2F; 小程序开发有没有什么最佳实践？</p><ul><li><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/audits/best-practice.html">最佳实践 | 微信开放文档</a></li><li><a href="https://www.jianshu.com/p/9435633612e4">微信小程序的最佳实践 -知乎专栏</a> - 这个链接是简书的……</li><li><a href="https://refined-x.com/2019/02/25/%E6%97%B6%E9%9A%94%E4%B8%A4%E5%B9%B4%EF%BC%8C%E5%86%8D%E6%AC%A1%E4%B8%8A%E6%89%8B%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/">时隔两年，再次上手小程序开发</a></li></ul><p>&#x2F;&#x2F; Javascript Promise 是啥？</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Using_promises">使用 Promise</a> - 这个是写的最好的，也应该是最权威的</li><li><a href="https://wizardforcel.gitbooks.io/exploring-es6/content/md/24.10.html">Promise 的优缺点</a> - 这是一本儿书……</li><li><a href="https://juejin.cn/post/6844903544923881480">Promise一些小总结</a> - 配图不错</li><li><a href="https://medium.com/@keshidong.dev/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BApromise-69bcafbe4496">深入浅出Promise</a></li><li><a href="https://www.liaoxuefeng.com/wiki/1022910821149312/1023024413276544">Promise</a></li><li><a href="https://www.hangge.com/blog/cache/detail_1635.html">JS - Promise使用详解1（基本概念、使用优点）</a></li></ul><h3 id="如何发布小程序？"><a href="#如何发布小程序？" class="headerlink" title="如何发布小程序？"></a>如何发布小程序？</h3><p>参考文档：</p><ul><li><a href="https://www.jianshu.com/p/24059ee078ba">微信小程序从开发到上线</a></li><li><a href="https://www.sxl.cn/content/blog/xcxshenhe/">小程序审核大概要多久？审核标准是什么？</a></li></ul><h3 id="小程序发布更新后用户是怎么更新小程序的？"><a href="#小程序发布更新后用户是怎么更新小程序的？" class="headerlink" title="小程序发布更新后用户是怎么更新小程序的？"></a>小程序发布更新后用户是怎么更新小程序的？</h3><p>参考文档：</p><ul><li><a href="https://developers.weixin.qq.com/community/develop/doc/000404097207387d257b6685351800">小程序新版本发布后，老用户小程序没更新，也没有弹出自动更新的提示？</a></li><li><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/update-mechanism.html">小程序更新机制</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;开发环境搭建&quot;&gt;&lt;a href=&quot;#开发环境搭建&quot; class=&quot;headerlink&quot; title=&quot;开发环境搭建&quot;&gt;&lt;/a&gt;开发环境搭建&lt;/h2&gt;&lt;p&gt;照&lt;a href=&quot;https://www.ruanyifeng.com/blog/2020/10/wech</summary>
      
    
    
    
    <category term="c_新生代农民工" scheme="https://tsz.me/categories/c-%E6%96%B0%E7%94%9F%E4%BB%A3%E5%86%9C%E6%B0%91%E5%B7%A5/"/>
    
    
    <category term="记录" scheme="https://tsz.me/tags/%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>Switch!</title>
    <link href="https://tsz.me/hardware/switch.html"/>
    <id>https://tsz.me/hardware/switch.html</id>
    <published>2021-09-10T02:26:01.000Z</published>
    <updated>2021-09-10T02:26:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>购买 <a href="/hardware/xbox-one.html">Xbox</a> 是失败的。于是我给闺女又买了 Switch。</p><p>主机是在天猫国际上购买的。商品从香港发出，经澳门到国内转EMS，被税后送到我手中。前前后后大概花了十天半个月。从网络搜索结果来看，天猫国际也会发假货。拿到switch后的第一件事就是<code>对比装主机的盒子正面的序列号与主机身上的序列号是否一致</code>，一致后<code>开机，看看是否出现姨妈红</code>，进入系统后<code>对比“设置-主机-序列号信息”，与第一步的二码是否一致</code>。这是省略的验机步骤。如果感觉社会黑暗，可参考《<a href="https://www.zhihu.com/question/275598608">第一次拿到switch，怎么验货？</a>》中的高票回答进行全面验机。祝顺利上岸。</p><p>拼夕夕上的主机价格也差不多，但不用赔税，可以省下一个游戏的钱；大陆直接发货，到货速度理应会快不少。如果对拼夕夕的百亿补贴有信心，可以尝试在拼夕夕上买。</p><p>我是618下单的日版、花色、续航升级款。现在看价格又降了100元。你说618这种购物节平台没有宰客，我信你个大头鬼。</p><p>当时没考虑国行，<del>我坚信自己爱数字版游戏比实体卡带多一些</del>。有相当多的游戏并没有实体版。作为程序猿我选择支持正版游戏，但看别人玩<strong>破解版的主机游戏依然感觉真香。</strong></p><h2 id="配件"><a href="#配件" class="headerlink" title="配件"></a>配件</h2><p><strong>屏保</strong>一定要有，即使平时你的手机在裸奔。买光面还是磨砂的看个人吧。我买的是最便宜的光面。到货时屏保是碎的，最终用的是买手柄那家送的屏保……恩，屏保买别的配件时会有商家赠送。</p><p><strong>MicroSDXC卡</strong>用来存放游戏。U3，C10，90MB&#x2F;s以上的读写。128跟256G的价格差别不算大，我买的256G。512G对我来说短时间内用不到，我<code>目前</code>认为128G的我都用不完。</p><p><del>支持PD协议的充电器。</del> 我买的是倍思GaN 65W充电器，买回来后它并没有在switch上使用过。平时游戏的时间是晚上和节假日的下午，直接把switch放在座子上就够了……所以它现在替换了家里以前的手机慢充，以这种形式不发光、发热。如果你需要外带switch，且有最近几年的小米手机，那小米的充电器（支持12.0V1.67A输出）就能胜任switch掌机模式边玩边充电的工作，无需额外撒币。</p><p>额外的Joy-Con。我、媳妇儿、俩闺女，4手柄起步，属合理添置。买的杂牌动森款。左侧手柄在挤压时有异响；腕带拆卸时异常困难，腕带的滑动锁扣被拉折了。送的屏保倒是用上了……顺手给个客观评价到tb吧。我认为Joy-Con是消耗品，WD40用不到。</p><p><del>塞尔达传说荒野之息Amiibo。</del> 某宝买的，卡片形式，显然盗版的。看完这篇文章你会发现有其他方法取得这些Amiibo。</p><p>目前就买了这些配件。别听一些UP主胡bb，<code>屏保、SD卡买了之后根据实际使用情况确定需求后再下单</code>是我的建议。</p><h2 id="游戏"><a href="#游戏" class="headerlink" title="游戏"></a>游戏</h2><p>《<strong>Super Mario: Party</strong>》港区数字版。《超级马力欧：派对》推荐的人挺多，玩起来也还行，但我们玩的不多：家里5岁的孩子算是能理解其中的玩法，但2岁的老二可就不能了……各种捣乱，游戏无法正常进行。大人玩了两局，熟悉之后我只觉得简单、无聊。或许大人多了会好玩？疫情纪元2年，亲戚未曾团聚过。疫情后时代再看。当下认为不该买。</p><p>《<strong>The Legend of Zelda: Breath of the Wild</strong>》港区数字版，未购买DLC。《塞尔达传说 旷野之息》买的不赖。一个人默默跑地图，像极了当年我在WoW中玩盗贼。到目前我在这个游戏上花费了200个小时。添加一个新账号给大闺女存档用，她挺愿意在游戏中捡道具，做饭，找呀哈哈，看望远镜，玩滑翔伞……的，打怪什么的交给我。即使我在玩，她也喜欢在旁边看着出些骚操作的主意。老二单纯喜欢在这个游戏里看天，白天晚上都无所谓……最起码能让游戏继续进行。推荐购买。</p><p>上两个游戏都是我用任亏券买的，事后总结下：任亏券买商品挺划算的；如果你愿意在一台switch上登陆多个同区账号的话，直接上Nintendo Switch Online家庭会员可以云端备份所有家人的游戏存档；如果你无法提前知道家人是否喜欢&#x2F;适合这类游戏类型，<strong>卡带是你最好的选择</strong>，家人&#x2F;自己不喜欢的话出掉回血就好。</p><p>国内的网络环境让游戏下载变的困难。v2ray的下载速度不及其他平台提供的switch加速器。由于没有尝试联机游戏，无法确定加速器在游戏时的网络稳定性。联通网络直连也有非常缓慢的游戏下载速度，移动网络直连无法下载。</p><p>《<strong>Mario Kart 8 Deluxe</strong>》实体卡带。《马里奥赛车8：豪华版》推荐的人也不少，和跑跑卡丁车是一样的。家里俩小的都能玩，但都玩的时间不长。4人同屏的话电视机被划分的区域太小，老大闺女在玩两把后会说眼睛累。又或者是因为老输不想玩？我联网玩就总是输，常常搞到不想玩。老二就更简单了，打开游戏后把手柄放下就跑开了，游戏因此可以继续下去。这次是接受之前的教训买了实体版，但游戏次数不多的现实让我出也不是，不出也不是……算了，放在机器里面防止卡槽进灰吧。</p><p>试过游戏联机了，时连时不连的。我没去确定具体原因。原本想购买《Splatoon 2（漆弹大作战2）》的，看情况放弃了。我不确定自己有时间玩，也不确定网络能畅通。在塞尔达还没玩通关的情况下额外配置加速路由器显得多余。<strong>如果我一直这样玩单机游戏，那最初直接购买破解版主机才是明智选项。</strong></p><p>《<strong>Diablo III: Eternal Collection</strong>》美区数字版。《暗黑破坏神3》的购买完全是为信仰充值。我是伞兵！买它是因为它在搞特价！我在PC上玩过这个游戏，但在switch上的游戏体验完全是另一回事。switch机能啊！疫情期间买来后仅打开了一次，深深的懊悔。</p><p>《<strong>Just Dance 2020</strong>》美区数字版。《舞力全开2020》是疫情期间媳妇儿让下单的，主要是她在玩。大闺女也喜欢跳，可她总拿不到第一名。常常会看到媳妇儿左手拿着自己的手柄，右手拿着大闺女的手柄在跳。老二对这个游戏不感冒。事实表明，玩游戏无法减肥。购买时在促销，游戏频次也在线，这次消费令人满意。</p><p>上面两个游戏都是在低价时入手数字版的。当前switch上注册登陆了3个区的账号来买游戏，同时区分不同家庭成员的游戏存档。最开始我纠结于如何在不同大区绑定自己的PayPal或信用卡进行支付，后来发现在靠谱的商家直接下单购买兑换卡更方便。我在微信里的Jump商城购买的美区点卡。淘宝上有更便宜的卖家，我不愿意冒着ban机的风险花时间去对比他们。</p><p>了解游戏价格可以使用Jump微信小程序或遊戲箱子app。</p><h2 id="相关工具、资料"><a href="#相关工具、资料" class="headerlink" title="相关工具、资料"></a>相关工具、资料</h2><p>这里说两个安卓手机应用，TagMo和Joy-Con Droid。</p><p><a href="https://github.com/HiddenRamblings/TagMo/releases">TagMo</a> 让用户可以通过手机的NFC直接读取或写入amiibo。先说读取，读取时需要用到的加密key(unfixed-info.bin和locked-secret.bin)可以从<a href="/res/TagMo_Key.zip">我的存档</a>中下载。网上很多人提到的amiibo数据下载站<code>nfc-bank.com</code>我无法打开，这个网站大概率挂掉了。不过有人收集了amiibo数据其他的下载链接，这个不难找。购买NTAG215白卡，通过应用向里面写数据我没有测试。我想起来找这类软件的时候已经下单了我想要的塞尔达amiibo……（我还为别的需求买了PM3）我买的amiibo卡片的提取数据在<a href="/res/Zelda_Amiibo_Data_25.zip">这里</a>。</p><p><a href="https://apkpure.com/joycon-droid-requires-root-magisk/com.rdapps.gamepad">Joy-Con Droid</a> 需要手机的ROOT权限，它可以让你的手机当做Joy-Con来使用。从<a href="https://joycon.gitbook.io/joycondroid/guide/using-amiibo-files">文档</a>上来看，某些受支持的机器还可以直接模拟读取到了amiibo，这样你甚至都不用写ntag215卡片，只要安心下载amiibo数据就好。</p><p>还有一些其他资料，链接一并放在这里：</p><ul><li><a href="https://github.com/dekuNukem/Nintendo_Switch_Reverse_Engineering">Nintendo_Switch_Reverse_Engineering</a> - Switch 逆向工程</li><li><a href="https://github.com/mumumusuc/bluez-ns-controller">bluez-ns-controller</a> - 使用bluez模拟Nintendo Switch的Pro手柄</li><li><a href="https://github.com/wchill/SwitchInputEmulator">SwitchInputEmulator</a> - 通过Arduino模拟手柄。<strong>塞尔达刷古代核心时需要不断点击A键进行拾取，我的手快废了。有必要了解这个项目实现宏录制。</strong></li></ul><p>到此，我深深地感受到我是正版用户的受害者。正版的switch不支持串流，我无法通过手机+蓝牙手柄随时随地玩耍。如果我想做到这些，我需要再买个Switch Lite，或者买个包包带着switch和充电器，或者<a href="https://www.bilibili.com/video/BV1aE411D7Dd">买个采集卡</a>（<a href="https://www.bilibili.com/video/BV15J411U7ne">实现</a>）……</p><p>再放几个相关Channel：</p><ul><li><a href="https://www.youtube.com/user/amu0813">AMU Game Channel</a> - 游戏录制</li><li><a href="https://www.youtube.com/channel/UCAQmUESq4GxO1b_iBCrYlTA">Dio Chan</a> - switch种草</li><li><a href="https://www.youtube.com/c/weiweigames">魏巍</a> - 很有礼貌的样子</li><li><a href="https://www.youtube.com/channel/UCvUJ6BwgUGWBHuUd0cv546g">小宁子</a> - 长的好看</li><li><a href="https://www.youtube.com/channel/UCUVpqH9jl41gS2sjFBZiIFQ">短发塞尔达</a> - 搞</li><li>……</li></ul><h2 id="费用清单"><a href="#费用清单" class="headerlink" title="费用清单"></a>费用清单</h2><ul><li>主机1962.99（标价2699元，400元优惠券，被税后商家退税费336.01元）</li><li>税费336.01（税款273元，服务费50元，通知单邮寄费12元，手续费1.01元）</li></ul><p>小计：2299</p><ul><li>配件586.6（存储卡199元，充电器118元，手柄258元，屏保11.6元）</li></ul><p>小计：586.6</p><ul><li>Nintendo Switch Online 会员，129.76元（155港币，2021年，购买任亏券得是会员）</li><li>港区任亏券，543.32元（649港币，超级马力欧派对、塞尔达旷野之息）</li><li>塞尔达amiibo 25张，29元</li><li>马里奥赛车8，315元</li><li>暗黑破坏神3，192元（29.99美元）</li><li>舞力全开2020，107.01元（16.47美元）</li></ul><h2 id="游戏攻略"><a href="#游戏攻略" class="headerlink" title="游戏攻略"></a>游戏攻略</h2><h3 id="塞尔达旷野之息"><a href="#塞尔达旷野之息" class="headerlink" title="塞尔达旷野之息"></a>塞尔达旷野之息</h3><p>未来再整理吧，我还没有营救公主的计划。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;购买 &lt;a href=&quot;/hardware/xbox-one.html&quot;&gt;Xbox&lt;/a&gt; 是失败的。于是我给闺女又买了 Switch。&lt;/p&gt;
&lt;p&gt;主机是在天猫国际上购买的。商品从香港发出，经澳门到国内转EMS，被税后送到我手中。前前后后大概花了十天半个月。从网络搜索结</summary>
      
    
    
    
    <category term="c_设备" scheme="https://tsz.me/categories/c-%E8%AE%BE%E5%A4%87/"/>
    
    
    <category term="游戏主机" scheme="https://tsz.me/tags/%E6%B8%B8%E6%88%8F%E4%B8%BB%E6%9C%BA/"/>
    
    <category term="开箱" scheme="https://tsz.me/tags/%E5%BC%80%E7%AE%B1/"/>
    
  </entry>
  
  <entry>
    <title>空中有朵棉花糖</title>
    <link href="https://tsz.me/p/20210903_microblog.html"/>
    <id>https://tsz.me/p/20210903_microblog.html</id>
    <published>2021-09-03T10:31:40.000Z</published>
    <updated>2021-09-03T10:31:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>2021年9月3日</p><p>看，天上的云卷卷的。它好像棉花糖呀。</p><p><img src="/images/ys2193.jpg" alt="头上有旋儿的云"></p><p><strong>后续：它是朵雨云！我被淋回来了……</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;2021年9月3日&lt;/p&gt;
&lt;p&gt;看，天上的云卷卷的。它好像棉花糖呀。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/ys2193.jpg&quot; alt=&quot;头上有旋儿的云&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;后续：它是朵雨云！我被淋回来了……&lt;/strong&gt;&lt;/p&gt;
</summary>
      
    
    
    
    <category term="原创" scheme="https://tsz.me/categories/%E5%8E%9F%E5%88%9B/"/>
    
    
    <category term="生活类" scheme="https://tsz.me/tags/%E7%94%9F%E6%B4%BB%E7%B1%BB/"/>
    
  </entry>
  
  <entry>
    <title>人生苦短的Python</title>
    <link href="https://tsz.me/p/20210902_%E4%BA%BA%E7%94%9F%E8%8B%A6%E7%9F%AD%E7%9A%84Python.html"/>
    <id>https://tsz.me/p/20210902_%E4%BA%BA%E7%94%9F%E8%8B%A6%E7%9F%AD%E7%9A%84Python.html</id>
    <published>2021-09-02T12:33:53.000Z</published>
    <updated>2021-09-02T12:33:53.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="问题清单"><a href="#问题清单" class="headerlink" title="问题清单"></a>问题清单</h2><h3 id="pymysql-连接池"><a href="#pymysql-连接池" class="headerlink" title="pymysql 连接池"></a>pymysql 连接池</h3><p>你知道的，为了我自己的那点需求，我已经解决了一个<a href="/p/202109_MySQL-%E6%90%9E%E5%AE%83.html#/1267%EF%BC%9A%E4%B8%8D%E5%90%88%E6%B3%95%E7%9A%84%E6%B7%B7%E5%90%88%E5%AD%97%E7%AC%A6%E9%9B%86">MySQL报错</a>。现在来解决另外一个问题。</p><ul><li><a href="https://www.codenong.com/cs108978725/">Pymysql 连接池操作</a> - 人家写的挺好</li><li><a href="https://blog.csdn.net/xc_zhou/article/details/80893289">[227]python数据库连接池DBUtils.PooledDB</a> - 写的更好</li><li><a href="https://webwareforpython.github.io/DBUtils/main.html">DBUtils User’s Guide</a> - 官方文档</li><li><a href="https://blog.csdn.net/weixin_41287692/article/details/83413775">Python 使用 PyMysql、DBUtils 创建连接池，提升性能</a> - 只是搜索结果指向它的比较多，但写的一般</li></ul><p>上面文章的内容都不难。直接无脑照抄代码……（2小时后）改完了。整个系统都改完了，能启动。部署到线上了。</p><p>然后来玩个测试。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">~$ </span><span class="language-bash">su -</span></span><br><span class="line"><span class="meta prompt_">~# </span><span class="language-bash">systemctl stop mysql.service</span> </span><br><span class="line"><span class="meta prompt_">~# </span><span class="language-bash">systemctl stop supervisor.service</span> </span><br><span class="line"><span class="meta prompt_">~# </span><span class="language-bash">systemctl start mysql.service</span></span><br><span class="line"></span><br><span class="line">// 在数据库中执行查询</span><br><span class="line">show status like &#x27;Threads%&#x27;;</span><br><span class="line">// 可以看到当前只有1个连接</span><br><span class="line"></span><br><span class="line">// 在窗口1执行</span><br><span class="line"><span class="meta prompt_">~# </span><span class="language-bash">python3 /usr/local/bin/les/test_a.py</span></span><br><span class="line"></span><br><span class="line">// 在数据库中执行查询</span><br><span class="line">show status like &#x27;Threads%&#x27;;</span><br><span class="line">// 当前有4个连接，连接新增的数量与mincached字段设置的一致（Threads_connected=4，Threads_created=4）</span><br><span class="line"></span><br><span class="line">// 在窗口2执行</span><br><span class="line"><span class="meta prompt_">~# </span><span class="language-bash">python3 /usr/local/bin/les/test_b.py</span></span><br><span class="line"></span><br><span class="line">// 在数据库中执行查询</span><br><span class="line">show status like &#x27;Threads%&#x27;;</span><br><span class="line">// 当前有7个连接（Threads_connected=7，Threads_created=7）</span><br><span class="line"></span><br><span class="line">// 在窗口2中^C打断程序的执行</span><br><span class="line"></span><br><span class="line">// 在数据库中执行查询</span><br><span class="line">show status like &#x27;Threads%&#x27;;</span><br><span class="line">// 当前有4个连接（Threads_connected=4，Threads_created=7，Threads_cached=3）</span><br><span class="line"></span><br><span class="line">// 在窗口1中^C打断程序的执行</span><br><span class="line"></span><br><span class="line">// 在数据库中执行查询</span><br><span class="line">show status like &#x27;Threads%&#x27;;</span><br><span class="line">// 当前有1个连接（Threads_connected=1，Threads_created=7，Threads_cached=6）</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">~# </span><span class="language-bash">systemctl start supervisor.service</span></span><br><span class="line">^D</span><br></pre></td></tr></table></figure><p>好的。我已经得到我想要的数据了。拜~</p><h3 id="tornado-高并发"><a href="#tornado-高并发" class="headerlink" title="tornado 高并发"></a>tornado 高并发</h3><p>2021.9.4 更新</p><p>现在是中午时间，没事做。就看看资料呗。<a href="https://www.cnblogs.com/terencezhou/p/7615572.html">Tornado实现多线程、多进程HTTP服务</a> <del>一篇足以讲清整个问题（讲不清）</del>。</p><p>2021.10.1 更新</p><ul><li><a href="https://github.com/zyt531/vamos/wiki/%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%8C%E5%A4%9A%E8%BF%9B%E7%A8%8B%EF%BC%8C%E5%8D%8F%E7%A8%8B-%E5%9F%BA%E7%A1%80%E4%BA%86%E8%A7%A3">多线程，多进程，协程 基础了解</a></li><li><a href="https://blog.csdn.net/cherrycheng_/article/details/51384657">基础知识：线程，进程。多进程，多线程。并发，并行的区别</a></li><li><strong><a href="https://blog.csdn.net/qq_27825451/article/details/86162597?depth_1-utm_source=distribute.pc_relevant.none-task&utm_source=distribute.pc_relevant.none-task">python协程系列（四）——同步&#x2F;异步、并发&#x2F;并行、线程&#x2F;进程</a></strong> - 讲的很基础，比较容易说明问题。这个博主相关的<a href="https://so.csdn.net/so/search?q=python%E5%8D%8F%E7%A8%8B%E7%B3%BB%E5%88%97&t=blog&u=qq_27825451">python协程系列</a>都可以读一读。</li><li><a href="https://segmentfault.com/a/1190000003063859">Linux IO模式及 select、poll、epoll详解</a></li><li><a href="https://zhuanlan.zhihu.com/p/63179839">如果这篇文章说不清epoll的本质，那就过来掐死我吧！ （1）</a> - 我想说的其实是这个系列，这里只放个（1）</li><li><a href="https://blog.csdn.net/u012089823/article/details/88244884">tornado 异步高并发</a> - 这是之后所有搜索关键字的种子</li><li><a href="https://blog.csdn.net/weixin_43097301/article/details/84981441">Python3中tornado高并发框架</a> - 这是一篇大而全的文章，甚至还提到了WebSocket…但是，这篇文章中有2个图是不错的，而且例子也简单，适合入门</li><li><a href="https://www.zhihu.com/question/354412469">tornado IO并发真的很高么？</a> - 没啥用，但是不影响了解下</li><li><a href="https://www.jianshu.com/p/de7f04e65618">Tornado异步原理详析</a> - 简单的说，就是如果你超有钱，可以做到无限的系统资源，那么其他多线程的服务器会更爽……同时提供了一个建议的服务器监听代码</li></ul><p>上面看了这么多，应该已经大概有些感性的认识了。下面自己去做两个demo体会下，然后继续这个话题。</p><p>高并发的话题现在莫名其妙的就跑到异步了……</p><p>2021.10.2 更新</p><ul><li>《Python 3 程序开发指南（第二版）》，第8章、第10章。 - 是的，这次直接看的是书。这两章会让新手看的迷糊，但是不要紧。</li><li><strong><a href="https://www.cnblogs.com/chry/p/10680113.html">python中和生成器协程相关的yield之最详最强解释，一看就懂（一）</a></strong></li><li><a href="https://www.jianshu.com/p/6a56f8f7be0a">Python协程、yield、yield from</a> - <strong>读的多了，可能会更容易理解些</strong></li><li><a href="https://www.cnblogs.com/zingp/p/8678109.html">再议Python协程——从yield到asyncio</a> - 直到这一篇，使用多进程、多线程、协程的所有缺点都列完了。剩下的就看自己的选择了</li></ul><p>2021.10.3 更新</p><p>……我做出了自己的选择：放弃 Tornado，转向 Flask。因为这样的服务完全用不上 tornado 的特性。还不如选择一个更大众的方式来进行这样的操作。换了 Flask 后，该是同步的还是同步的操作。剩下的问题，就交给部署运维吧。</p><ul><li><a href="https://segmentfault.com/q/1010000004532745">flask是如何处理多个访问请求的?</a></li><li><a href="https://zhuanlan.zhihu.com/p/31635068">知乎是怎么运行 tornado web 服务的</a> - 你会发现大厂也没有使用 tornado 的特性。<del>大家写异步都废脑子。</del></li><li><a href="https://blog.csdn.net/yuanlulu/article/details/89577692">python之web server搭建：Gunicorn、flask及tornado</a></li><li><strong><a href="https://cloud.tencent.com/developer/article/1549550">Flask 高并发部署方案详细教程！</a></strong></li><li><a href="https://segmentfault.com/q/1010000004501782">Flask 阻塞的问题</a></li><li><a href="https://cloud.tencent.com/developer/article/1572261">[750]flask之异步非堵塞实现</a> - 无用的额外了解扩充</li><li><a href="https://www.codenong.com/cs109708788/">flask+Gunicorn(gevent)高并发的解决方法探究</a> - 想看了看看</li><li><a href="https://stackoverflow.com/questions/11860385/flask-mysql-app-seems-to-be-blocking-concurrent-requests-when-query-is-complicat">Flask&#x2F;MySQL app seems to be blocking concurrent requests when query is complicated</a> - 如果还想用 tornado 的话，换到 MongoDB 再用异步库也是可以的……</li><li><a href="https://cgdeeplearn.github.io/2020/05/18/Mirco-service/">简单的python 微服务小框架</a> - 又或者自己实现一个服务框架……</li><li><a href="http://blog.vogelcs.com/archives/%E5%85%B3%E4%BA%8Eflask%E5%90%8E%E7%AB%AF%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E6%98%AF%E5%90%A6%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8%E5%88%B0%E8%BF%9B%E7%A8%8B%E6%B1%A0">关于flask后端处理数据库是否需要使用到进程池</a></li><li><a href="https://pythonrepo.com/repo/ydf0509-object_pool_proj-python-miscellaneous">万能通用对象池，可以池化任意自定义类型的对象。</a> - 我没看……</li><li><a href="https://blog.csdn.net/qq_41433183/article/details/89578363">python笔记(flask DButils 数据库锁，请求上下文管理（LocalProxy,app,g）)</a> - 也没看，只是放在这儿……</li></ul><p><strong>没有想到，事情最后的解决办法竟然是这样的……</strong></p><blockquote><p>现在有另外一个问题需要验证：<br>连接池会有多个数据库连接。现在假如说 Flask 通过 Gunicorn 多进程部署了，那是不是说，数据库连接的数量就要翻倍了？</p></blockquote><p>2021.10.4 更新</p><p>再扯些别的。</p><ul><li><a href="https://www.ruanyifeng.com/blog/2018/10/restful-api-best-practices.html">RESTful API 最佳实践</a></li><li><a href="https://cloud.tencent.com/developer/article/1579007">13 个设计 REST API 的最佳实践</a></li><li><a href="http://kaelzhang81.github.io/2019/05/24/Restful-API%E8%AE%BE%E8%AE%A1%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">Restful API设计最佳实践</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;问题清单&quot;&gt;&lt;a href=&quot;#问题清单&quot; class=&quot;headerlink&quot; title=&quot;问题清单&quot;&gt;&lt;/a&gt;问题清单&lt;/h2&gt;&lt;h3 id=&quot;pymysql-连接池&quot;&gt;&lt;a href=&quot;#pymysql-连接池&quot; class=&quot;headerlink&quot; ti</summary>
      
    
    
    
    <category term="c_新生代农民工" scheme="https://tsz.me/categories/c-%E6%96%B0%E7%94%9F%E4%BB%A3%E5%86%9C%E6%B0%91%E5%B7%A5/"/>
    
    
    <category term="记录" scheme="https://tsz.me/tags/%E8%AE%B0%E5%BD%95/"/>
    
    <category term="开发" scheme="https://tsz.me/tags/%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>MySQL，搞它</title>
    <link href="https://tsz.me/p/20210901_MySQL-%E6%90%9E%E5%AE%83.html"/>
    <id>https://tsz.me/p/20210901_MySQL-%E6%90%9E%E5%AE%83.html</id>
    <published>2021-09-01T09:00:06.000Z</published>
    <updated>2021-09-01T09:00:06.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h2><h3 id="1267：不合法的混合字符集"><a href="#1267：不合法的混合字符集" class="headerlink" title="1267：不合法的混合字符集"></a>1267：不合法的混合字符集</h3><p>之前写了个简单工具来维护我的一些个人记录。随着发展，这个工具无法满足我的进一步需求，就做了些改动。跟着而来的就是原本本地运行的程序，得放到云上去了。做了新环境，部好了程序。测试时发现程序未按预期执行，看程序日志，喜提报错（没错，这是个python<del>程序</del>脚本）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pymysql.err.OperationalError: (1267, &quot;Illegal mix of collations (utf8mb4_0900_ai_ci,COERCIBLE) and (utf8mb4_general_ci,COERCIBLE) for operation &#x27;=&#x27;&quot;)</span><br></pre></td></tr></table></figure><h4 id="问题的产生"><a href="#问题的产生" class="headerlink" title="问题的产生"></a>问题的产生</h4><p>根据 <a href="https://bbs.huaweicloud.com/blogs/273041">一个字符校对规则引发的血案</a> 这篇文章的总结，产生的原因就是<code>在MySQL 8.0建表时，如果指定字符集是utf8mb4的话，表的默认collation是utf8mb4_0900_ai_ci。utf8mb4_0900_ai_ci与utf8mb4_general_ci是互斥的，而MySQL不允许两个互斥的校验规则的数据做对比</code>。</p><p><strong>那CHARSET和COLLATE又是什么鬼呢？</strong></p><ul><li><a href="https://www.huaweicloud.com/articles/c133cbeb355f52cc9a404e42ef7f4895.html">MySQL的字符集(Character Set)和校对集(Collate)</a></li><li><a href="https://www.iteye.com/blog/zhongwei-leg-899227">mysql 中 character set 与 collation 的点滴理解</a></li><li><a href="https://cloud.tencent.com/developer/article/1366841">MYSQL中的COLLATE是什么？</a></li></ul><p>通读上面这些文章并梳理后，我们可以得到以下这些平时并没有什么鸟用的知识点：</p><ol><li>字符集的层次有4个：服务器(server)，数据库(database)，数据表(table)和连接(connection)  <em>– 注：我对这条有质疑</em></li><li>database character set, table character set, field character set 可逐级覆盖</li><li>使用字符集的过程：服务器收到来自 client 的查询，将查询串从 character_set_client 转换到 character_set_connection，服务器将转换后的查询的执行结果转换到 character_set_results 字符集后发回</li><li>如何用sql语句来查看client、connection、server、results的字符集设置：<code>SHOW VARIABLES LIKE &#39;%character_set%&#39;;</code></li><li><code>set names N</code>语句是同时设置client、connection、results字符集为N的合并简写（意思就是，无论怎样，server你不能搞，别的我都不屌）</li><li>如何查看系统的所有字符集：<code>SHOW CHARACTER SET;</code></li><li>mysql有两个支持unicode的character set：1，ucs2 - 使用16 bits来表示一个unicode字符；2，<del>utf8 - 使用1~3 bytes来表示一个unicode字符（</del> <strong>utf8mb4</strong> <del>）</del></li><li>character set与collation有对应关系（每个character set会对应一定数量的collation），可以通过语句查看系统的Collation及对应关系：<code>show collation;</code></li><li>collation的命名规则有两类：<code>&lt;character set&gt;_&lt;language/other&gt;_&lt;ci/cs&gt;</code>和<code>&lt;character set&gt;_bin</code></li><li>同一个character set的不同collation的区别在于排序、字符串对比的准确度（<strong>相同两个字符在不同国家的语言中的排序规则可能是不同的</strong>）以及性能</li><li>凡是涉及到字符类型比较或排序的地方（ORDER BY，WHERE条件中大于小于号的筛选结果，DISTINCT、GROUP BY、HAVING），都会和COLLATE有关</li><li>仅对utf8mb4_unicode_ci和utf8mb4_general_ci做对比时，utf8mb4_unicode_ci可能更正确那么一丢丢</li><li>设置COLLATE可以在示例级别、库级别、表级别、列级别、以及SQL指定。优先级顺序是 SQL语句 &gt; 列级别设置 &gt; 表级别设置 &gt; 库级别设置 &gt; 实例级别设置</li><li>utf8mb4_0900_ai_ci大体上就是unicode的进一步细分，0900指代unicode比较算法的编号（Unicode Collation Algorithm version），ai表示accent insensitive（发音无关），例如e, è, é, ê和ë是一视同仁的</li></ol><p>如果想了解更多信息，可访问：</p><ul><li><a href="https://www.cnblogs.com/wcwen1990/p/6917109.html">MySQL字符集详解</a></li></ul><h4 id="问题的验证"><a href="#问题的验证" class="headerlink" title="问题的验证"></a>问题的验证</h4><p>知道这些应该已经差不多了吧……接下来需要验证一下我遇到的报错到底发生在哪里。</p><p>查看一下报错的SQL：是一条对视图的select，有附加的where语句。<strong>放在navicat中单独执行这条sql，是没有问题的……</strong> &lt;- 请注意我的这句话</p><p>再看看数据库的collation：<code>show variables like &#39;collation%&#39;;</code>（根据无用知识点的举一反三）。因为我的数据库是由navicat直接同步表结构和数据的，所以表的collation我就不再看了……</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;collation%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+--------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name        <span class="operator">|</span> <span class="keyword">Value</span>              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+--------------------+</span></span><br><span class="line"><span class="operator">|</span> collation_connection <span class="operator">|</span> utf8mb4_0900_ai_ci <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> collation_database   <span class="operator">|</span> utf8mb4_0900_ai_ci <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> collation_server     <span class="operator">|</span> utf8mb4_0900_ai_ci <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+--------------------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><h4 id="问题的解决"><a href="#问题的解决" class="headerlink" title="问题的解决"></a>问题的解决</h4><ul><li><a href="https://stackoverflow.com/questions/11770074/illegal-mix-of-collations-utf8-unicode-ci-implicit-and-utf8-general-ci-implic">stackoverflow</a> 上的高票答案列举了4种解决办法，并且强调了上面无用知识点中的第12条 <code>UPDATE: utf8mb4/utf8mb4_unicode_ci is now the preferred character set/collation method. utf8_general_ci is advised against, as the performance improvement is negligible. See https://stackoverflow.com/a/766996/1432614</code></li><li><a href="https://learnku.com/articles/41546">阿隆索逃跑了</a> 除了解决问题，还记录了ta验证问题的更多步骤</li></ul><p>该是终结这一切的时候了！</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su -</span><br><span class="line">systemctl restart mysql.service  // 目的是为了断开当前所有的连接</span><br><span class="line">mysql -uroot -p  // 连接到数据库</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DATABASE `dbname` <span class="keyword">COLLATE</span> <span class="string">&#x27;utf8mb4_general_ci&#x27;</span>;</span><br><span class="line"><span class="operator">^</span>d</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart supervisor.service</span><br><span class="line">^d</span><br></pre></td></tr></table></figure><p>恩，是检验成果的时候了……WTF，报错依旧啊……</p><p>好吧，再重新看一遍报错的sql语句吧……是对一个视图进行查询。那视图的定义是什么呢？细看。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> wkey <span class="keyword">AS</span> wkey, wvalue <span class="keyword">AS</span> wvalue, <span class="string">&#x27;user_a&#x27;</span> <span class="keyword">AS</span> uname </span><br><span class="line"><span class="keyword">FROM</span> config_a </span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line"><span class="keyword">SELECT</span> wkey, wvalue, <span class="string">&#x27;user_b&#x27;</span> </span><br><span class="line"><span class="keyword">FROM</span> config_a</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>我是针对<code>uname</code>这个字段进行的查询，而这个字段中的数据并不存储在数据库中，而是直接由视图语句生成出来的，所以可以做出如下推断（？）：collation_database并不能控制sql语句产生的字段。既然这个字段无法控制，那collation_server字段总应该行了吧？</p><p>该是终结这一切的时候了！</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/mysql/mysql.conf.d/mysqld.cnf  -- 这个是ubuntu上mysql的配置文件</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 在 [mysqld] 段落下添加配置项</span><br><span class="line">// 配置依据 https://dev.mysql.com/doc/refman/8.0/en/charset-applications.html</span><br><span class="line"></span><br><span class="line">character-set-server = utf8mb4</span><br><span class="line">collation-server = utf8mb4_general_ci</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart mysql.service</span><br><span class="line">sudo systemctl restart supervisor.service</span><br></pre></td></tr></table></figure><p>恩，又是检验成果的时候了……纳尼？玩我的是吧！摔！！</p><p>冷静。<strong>如果我上述的操作已经可以保证字段是utf8mb4_general_ci的话，那报错中的utf8mb4_0900_ai_ci，应该是指我传给服务器的数据了？</strong>（事实上，我是照着这样的思路去想的，但并没有去验证）看样子还得修改collation_connection。</p><p>该是终结这一切的时候了！</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 在 [mysqld] 段落下 再！添加配置项</span><br><span class="line">// 配置说明见</span><br><span class="line">// https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_init_connect</span><br><span class="line">// https://dev.mysql.com/doc/refman/8.0/en/charset-connection.html</span><br><span class="line"></span><br><span class="line">init-connect=&#x27;SET NAMES utf8mb4&#x27;</span><br><span class="line">init_connect=&#x27;SET collation_connection = utf8mb4_general_ci&#x27;</span><br><span class="line">skip-character-set-client-handshake</span><br><span class="line"></span><br><span class="line">// ...重启mysql和supervisor</span><br></pre></td></tr></table></figure><p>恩，又又是检验成果的时候了……泥马！！！开发环境正常执行，线上环境你还给我报错？！日狗了么！再TM搞不定，我就把5.7给装过来！这都快成玄学了啊……</p><ul><li>关闭 supervisor</li><li>关闭 mysql client</li><li>重启 mysql</li><li>打开 mysql client 从线上环境删除所有视图，重新向线上环境同步视图</li><li>启动 supervisor</li><li>做好挂b的准备，重新测试</li></ul><p>问题解决了……留下懵逼的我在风中凌乱……</p><p>扩展资料（我没细读，只是好奇罢了。未来遇到问题时再细看）：</p><ul><li><a href="https://blog.csdn.net/qq_39787367/article/details/97760284">Mysql8 和mysql 5.7 的区别</a></li><li><a href="https://www.lifesailor.me/archives/2676.html">MySQL升级8.0的新故障，utf8mb4_0900_ai_ci是啥？</a></li><li><a href="https://www.laruence.com/2008/01/05/3264.html">深入Mysql字符集设置</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;报错&quot;&gt;&lt;a href=&quot;#报错&quot; class=&quot;headerlink&quot; title=&quot;报错&quot;&gt;&lt;/a&gt;报错&lt;/h2&gt;&lt;h3 id=&quot;1267：不合法的混合字符集&quot;&gt;&lt;a href=&quot;#1267：不合法的混合字符集&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    <category term="c_新生代农民工" scheme="https://tsz.me/categories/c-%E6%96%B0%E7%94%9F%E4%BB%A3%E5%86%9C%E6%B0%91%E5%B7%A5/"/>
    
    
    <category term="MySQL" scheme="https://tsz.me/tags/MySQL/"/>
    
    <category term="数据库" scheme="https://tsz.me/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>初步了解LGBT</title>
    <link href="https://tsz.me/p/20210830_%E5%88%9D%E6%AD%A5%E4%BA%86%E8%A7%A3LGBT.html"/>
    <id>https://tsz.me/p/20210830_%E5%88%9D%E6%AD%A5%E4%BA%86%E8%A7%A3LGBT.html</id>
    <published>2021-08-30T04:56:13.000Z</published>
    <updated>2021-08-30T04:56:13.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="LGBT-相关（正文）"><a href="#LGBT-相关（正文）" class="headerlink" title="LGBT 相关（正文）"></a>LGBT 相关（正文）</h2><p>之前并没有了解过LGBT的消息。即使最近的这段时间微信正在大规模封锁高校LGBT学生社团的公众号，试图引发寒蝉效应，限缩其发声及沟通管道（<a href="https://www.dw.com/zh/%E4%B8%AD%E5%9B%BD%E9%AB%98%E6%A0%A1lgbt%E5%B8%90%E5%8F%B7%E9%81%AD%E5%B0%81-%E5%AD%A6%E8%80%85%E5%90%8C%E5%BF%97%E5%9B%A2%E4%BD%93%E7%9A%84%E8%87%B4%E5%91%BD%E4%B8%80%E5%87%BB/a-58198503">相关报道</a>）。</p><p>今天看到 <a href="https://twitter.com/haqilin">@haqilin</a> 的<a href="https://twitter.com/haqilin/status/1432035668197322756?s=20">推文</a>后，感觉LGBT群体所遇到的问题可能会关系到我对孩子的教育，故准备稍稍做些了解。</p><p>先来了解一下关于LGBT的一些名词和定义。<a href="https://zh.wikipedia.org/wiki/LGBT">百科传送门</a>在此。</p><ul><li><strong>L</strong>esbian：女同性恋者</li><li><strong>G</strong>ay：男同性恋者</li><li><strong>B</strong>isexual：双性恋者</li><li><strong>T</strong>ransgender：跨性别者。主要包括那些性别认同与出生时的指定性别相反的人</li><li><strong>Q</strong>ueer：酷儿，是同性恋、双性恋、跨性别总称。</li><li><strong>Q</strong>uestioning：疑性恋，对其性别认同感到疑惑的人（性别存疑）</li><li><strong>I</strong>ntersex：双性人，俗称阴阳人。天生具有“不符合男性或女性身体的典型二元概念”的生理性别特征的人。</li><li><strong>T</strong>ranssexual：变性人（或异装癖）</li><li><strong>A</strong>sexual：无性恋、无性向</li><li>Straight <strong>A</strong>llies：支持同性恋的异性恋盟友</li><li>…上面的名词已经够用了，不再列出更多了</li></ul><p>看完百科的头一个感觉，就是LGBT+的划分不是一般的乱：虽然他们有着统一提高LGBT权益的诉求，但是他们内部对自己的身份归属的认同并不统一。当然，这并不是本文的重点。我只关心ta在成长过程中遇到的问题。</p><blockquote><p>我一直不太愿意参与跨性别讨论，大概因为我作为曾经的跨性别因为滥用性激素给自己的身体造成了不可逆的伤害。 #thread – from @haqilin</p></blockquote><p><code>滥用性激素</code>，根据上下文，此处应该是指跨性别男性使用睾酮等雄激素来进行男性化<a href="https://zh.wikipedia.org/wiki/%E8%B7%A8%E6%80%A7%E5%88%AB%E6%BF%80%E7%B4%A0%E7%96%97%E6%B3%95">激素替代疗法</a>（简称HRT）。</p><p>搜索网络，有以下两篇我关心的点：</p><ol><li><a href="https://zhuanlan.zhihu.com/p/26151577">跨性别者使用激素会折寿吗？</a> <strong>注：我看文章第一段像是机器翻译，未再深挖。这个链接的内容未必正确，只是提的问题很好。</strong></li><li><a href="https://www.bilibili.com/video/BV1n5411W7Ue/">跨性别女孩HRT激素治疗两年的变化~</a> bilibili 未下架视频，真好。</li></ol><blockquote><p>我青春期时发现自己喜欢女性的身体，但又因为社会的性别歧视厌恶自己的女性身份，在听了一个跨性别的演讲后相信我是“男人的灵魂长在了错误的身体里，拥抱真实的自己需要变性”。后来接触到一些性别研究爱好者，每一个生理女性都或多或少有厌恶女性身份的一段时间，但是她们知道这是社会性的厌女，不是女性的问题，身体就是灵魂，身体就是自己，拥抱真实的自己就是接受自己的身体。我真的很后悔当时为什么要这么做，现在我必须服用雌激素控制多囊卵巢，然而我本来不需要这么做的。我喜欢女性的身体，我曾以为灵魂有性别，但没人告诉我女性也可以喜欢女性的身体，没人告诉我使用雄性激素后性别歧视也仍然在，要融入男人这个集体还要参与无数无聊的玩笑，跟着一起伤害别人；即使真的做了手术变成男人，也只是逃避到了一个相对安全的地方，社会上存在的一切歧视都不会改变。 – from @haqilin</p></blockquote><p><code>因为社会的性别歧视厌恶自己的女性身份</code>：即女性贬抑（英语：Misogyny），也称<a href="https://zh.wikipedia.org/wiki/%E5%A5%B3%E6%80%A7%E8%B4%AC%E6%8A%91">厌女症</a>。表现方式有：</p><ul><li><strong>社会排斥</strong></li><li>性别歧视</li><li>敌意女性</li><li>男性中心主义</li><li>父权制</li><li>男性特权</li><li>贬低女性</li><li>对女性的暴力行为</li><li>部分现代女性对男性的过分要求</li><li>把女性性对象化</li></ul><h3 id="社会性的厌女，不是女性的问题"><a href="#社会性的厌女，不是女性的问题" class="headerlink" title="社会性的厌女，不是女性的问题"></a>社会性的厌女，不是女性的问题</h3><p>这个问题是如何产生的，及相关资讯：</p><ul><li><a href="https://zhuanlan.zhihu.com/p/25943494">我曾经很讨厌自己是个女人</a> - 知乎专栏。已存档备份。</li><li><a href="https://book.douban.com/subject/25836270/">《厌女》</a> - 豆瓣读书，作者：(日)上野千鹤子，出版社：上海三联书店</li></ul><p><strong>这才是我真正关心的，原来问题是这样产生的。这个问题与女权主义竟然还有关系……我没想到。</strong></p><blockquote><p>我的想法和那时一样：外人对LGBT包容、不干预是恰当的，鼓励则不是。当他们被歧视、侮辱时，应该反对这些歧视和侮辱，也就是反对那种不包容的态度。 – from @JianminM</p></blockquote><p>此时再看，这位推友的看法应该被划归为被动中立。仅仅的包容是不够的，跨性别者的产生有社会及其它因素，改变这些导致恶意后果的现象，对于剩下自然发生的案例再保持这样的包容，才是恰当的。可是回头再看，<strong>这个问题是个死循环</strong>：还以社会排斥为例，现象是导致贬抑的成因，同时也是导致贬抑的后果……这娃套的真大。<del>由此问题产生出来的女权主义者看不到么？（这句先删掉，我需要了解更多的资讯才能判断提出这个问题是否合理）</del></p><p>可我是父亲，照顾女儿是我无法推脱的责任。（哈，<code>推托</code>和<code>推脱</code>一样都是词，意思有不同……） <strong>我需要告诉我的孩子，她应该自信，男女在能力上并没有大的差别；她不应在意他人强加给她的限制。</strong> 至于社会杜绝排斥的现象，我对此表示悲观。换个角度来看，个人的成功与失败，真的需要别人来评价吗？</p><p>补充一些英文的含义，以便能更好的与人沟通：</p><ul><li>trans：这个词需要联系上下文……因为跨性别相关的大多数词都有 <code>trans-</code> 的前缀。</li><li>FtM: Female to Male, F2M, FTM, 在出生时就被赋予女性性别，但他们觉得自己是男性性别的一部分，并且已经开始从一种性别向另一种性别转变的跨性别者。跨性别男性。<a href="https://www.ricktroy.com/zh/ftm%E5%92%8Cmtf%E5%8F%98%E6%80%A7%E6%82%A3%E8%80%85%E8%BF%87%E6%B8%A1%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/">来源1</a> <a href="https://www.genderconfirmation.com/introduction-to-top-surgery/">来源2</a></li><li>MtF: Male to Female, M2F, MTF. 跨性别女性。</li><li>TS：双灵魂Two-Spirit？第三性别Third sex？我理解不到位，无法做出清晰地表述。</li></ul><blockquote><p>我接触过得mtf，或者准确的说法是ts，都或多或少遇到过一个类似的问题。因为激素水平的原因，狂热的想做手术，认为做手术是问题的最终解。等到切完了，激素水平掉到了另外一个水平，整个人想法变了，又因为激素水平的原因开始(有的是阶段性，有的是永久的)后悔，后悔自己做过的决定。 – from @biantaiIsabella</p></blockquote><p>果真，做事要三思啊。</p><h2 id="我曾经很讨厌自己是个女人（转载）"><a href="#我曾经很讨厌自己是个女人（转载）" class="headerlink" title="我曾经很讨厌自己是个女人（转载）"></a>我曾经很讨厌自己是个女人（转载）</h2><p>&#x2F;&#x2F;</p><p><strong>原文链接：<a href="https://zhuanlan.zhihu.com/p/25943494">https://zhuanlan.zhihu.com/p/25943494</a>，作者：<a href="https://www.zhihu.com/people/YakiShare">雅君</a></strong></p><p>此处转载仅用于防丢失。原文链接可用时，请移步原文阅读。</p><p>&#x2F;&#x2F;</p><p>前段时间我和你说过，我想写关于“我是如何成为女权主义者，以及我对女权主义看法”的文章。</p><p>我所说的“女权主义”，也就是平权主义，支持男女权利、机会平等，反对性别刻板印象。用“女”字是因为当下我们身处男权社会，女性权益更难得到保障，所以在话语上加以强调，希望唤起更多人对女性获得平等权利的重视，减少性别歧视。</p><p>而当我动笔写时，我发现，要解释“我是如何成为女权主义者”，我无法回避掉自己曾经是一个重度厌女症患者，以及现在也依然在和体内残存的厌女症做斗争的现实。</p><p>你没看错，从童年到青春期，很长一段时间里，我都是一个厌女症。</p><p>我努力隐藏和否定自身的女性倾向，不接受自己的女性身份，希望被当成男性来对待和接纳。</p><p>教会我厌女症的是轻视女性的男权社会。用《厌女》一书中的话说，在这样的社会里，“无论男人女人，无人能逃离厌女症的笼罩。厌女症弥漫在这个秩序体制之中，如同物体的重力一般，因为太理所当然而使人几乎意识不到它的存在。”</p><p>“换个更加浅显的说法，在迄今为止的人生中，有一次都没有庆幸过没生为女人的男人吗？有一次也没有抱怨过生为女人吃了亏的女人吗？”</p><p>我成为女权主义者、追求男女平权的过程，也是对自身厌女症从不自知到自觉自省、与之斗争的过程。</p><p>接下来我就要坦白我的<strong>厌女症病史</strong>了。</p><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><p>“你一点都没有姑娘家的样子。”这是我小时候经常听到的一句话。</p><p>小小的我就会想，什么叫“姑娘家的样子”？</p><p>我慢慢意识到，大人们口中“姑娘家的样子”大概是：乖巧斯文、安静整洁有收拾。最重要的一条是听话顺从。</p><p>但小时候的我并不符合这个标准——我爱跑爱跳、坐不住、胆子大、爬树翻墙一把好手，粗心冒失、丢三落四、不爱收拾，课桌一团乱，不注意干净，衣服才穿一天就脏了。</p><p>我童年住在大院里，除了我之外，其他家都是小男孩。我跟他们一起玩，我妈就会对我说，“你怎么老往外跑？”我如果说可是谁谁家的小朋友也在外面玩，我妈会说，“你是女孩子呀，斯文一点不好吗？”</p><p>在玩耍中，如果爸妈在，他们常会以“危险”为由禁止我玩某些游戏，“不要爬那么高／跑那么远……”但和我同龄的那些小男生们收到的来自家长的警告和管教则更少，指导和鼓励更多。</p><p>儿时的我就会困惑，为什么同样都是在外玩，男生们听到的更多是“小男孩淘气点正常，受点伤没事的，还能练皮实点。” 而我听到的更多是：“女孩子不要那么匪（fei,读3声，是我家那的方言，有淘气不听话的意思）啊。”</p><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><p>从那时起，我就感觉到，自己生活的世界里，好像有一本女生行为指南，上面写满了女生就该如何如何。</p><p>而我不想要被这个指南规范，也没兴趣做家长口中的“淑女”。</p><p>我只想痛痛快快去玩、去跑、去跳，有和男孩一样的自由。</p><p>不过诚实地说，那时我还没有仔细想，为什么这指南针对女生，而对男生没有这样的要求。</p><p>我只是觉得被这么要求，作为女生，我不舒服、不自在。</p><p>上小学时，有个关系不错的女生找我吐槽说，她爸妈重男轻女，什么好的，都给她弟弟。</p><p>我是家里唯一的小孩，但听她说完后，还是忍不住问我妈，你是不是原本比较想要男孩？我妈很诚实地告诉我，“你爸爸家里只有他一个男孩，我那时会比较希望怀的是个男孩。不过，你爸他是想要丫头的。”</p><p>她很爱我，但她心中依然有传宗接代的想法。当时还是小孩子的我，因着朴素的公平观觉得很委屈，“男孩、女孩不都是人嘛，不应该是一样的吗？”</p><p>多年后，我看到了一本家谱，家里的长辈告诉我，过去女人是不登记在家谱上面的。“不过现在上面有你的名字哦。” 我在阳光下，翻开那本家谱，此前密密麻麻都是男性名字，最近这一两代才出现了女性名，我突然对社会学家们说的那个词“被消失的女性”有了很直观的认识。</p><h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><p>初中时，我步入青春期，女性生理特征开始显现，月经初潮、乳房发育都在提醒我，我是一个女生。</p><p>但我周围环境传递给我的信息是，月经也好，身体发育也好，都有种见不得人的意味。因为老师也好、家长也好，很有默契地回避掉了生理教育这一课。同龄女生们提到月经，都用“那个”隐晦带过，那些身体发育较早的女生则往往成为男生私下讨论的话题。</p><p>班上男生会用投票方式做女生身材颜值的排行榜。我第一次听同学告诉我这事，我有种被评判、审视的感觉，我觉得不安全、被冒犯，但当时我又说不清，为什么会有这种感觉。我只会说“男生真无聊。”</p><p>后来学习性别理论，我才知道，这叫“男性凝视”，在男权社会下，女性是被看者，是客体，男性是观看者，是主体。我觉得不舒服是因为这种“凝视”本身就是不平等的，是自上而下的压迫。</p><p>我讨厌被当成“他者”来打量，也不想被“女生就该怎样”的标准来要求。</p><p>更诚实一点说，在“不愿意被标准要求”的背后，还藏着隐秘的自卑和自傲——我一方面觉得作为女生，自己不够好看、整洁、斯文。另一方面又觉得“我和那些娇气、爱哭、不能吃苦的女生才不一样呢”，那时的我并不知道我对女性的认知其实很狭隘，完全来自于男权社会灌输给我的刻板印象。</p><h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><p>这一切导致某个午后，读初中的我站在镜子前，凝视镜中的自己，默默决定：反正我没法按你们对女生的要求演好一个女生，那我就自觉脱离于女生队伍。</p><p>于是我的整个青春期都是以假小子形象度过，我剪短发，穿男装小码，颜色不是黑灰就是蓝绿，买了辆男士赛车，骑得飞快。</p><p>高中时，我和女同学下晚自习后，手拉手并排骑车回家，第二天就有看到我们背影的同学找她八卦，“我看到你昨晚和男生牵手啦，那男生是谁啊？”</p><p>这种被人错认成男生的事时有发生，而我也乐得被人当成男生。我现在分析当时的心态，大概是想通过把自己“男性化”而获得和男性一样的自由，更少评判、压制和约束。</p><p>虽然我的厌女症使得我不愿正视和接受自己的女性身份，但我还是很喜欢和女生一起玩，只是带着一种“我和你们不一样”的心态。</p><p>前段时间我在豆瓣上看到有个姑娘表述自己在厌女症时期对女生的感觉“类似于贾宝玉看姊妹，属于旁观，但‘没有跟他们是同类’的自觉”。我觉得这句话也准确说出了我当时的状态，觉得自己是“骑士”，其他女生是“公主”。</p><p>那时，我也有关系不错的男生朋友，在我内心，我希望他们把我看成和他们是一样的人。我会让男生朋友和我以“兄弟”相称。</p><p>我上大学后，有次和高中时的男性朋友见面，对方还习惯性地喊我喊“哥哥”。他身旁的女友很惊诧。现在想来，自己也觉得有点好笑。</p><p>初中时，有一次和男生有冲突，我跟对方说“放学后别走，我们打一架”。</p><p>我当时潜意识里，大概觉得男生之间有矛盾大多打架解决。而我把自己也看成是男生中的一员，自然地，我会选“男人式”的约架。</p><h3 id="5"><a href="#5" class="headerlink" title="5"></a>5</h3><p>那时的我一边刻意压抑自身让人联想起女生的性格和喜好，比如敏感、同理心强、爱美，一边努力表现自己大大咧咧、什么都无所谓的“男生”一面。</p><p>压抑到什么程度？</p><p>初中时，有次语文老师对我说，“你的文字很温柔、细腻，你的内心很女生啊。”我的第一反应是惊吓，回过神后立刻反驳，“我哪里女生了？”</p><p>“可是你的文字就是这么告诉我的呀。”老师笑着说。</p><p>“我手写我心”的文字的确很难隐藏一个人的内心属性，而我连文字泄漏我有女性化的一面都感到恐慌。</p><p>我后来读到《厌女》这本书对厌女症的阐述时，深有共鸣：</p><p>“男人的厌女症，是对他者的歧视和侮辱。因为男人不必担心会成为女人，所以可以放心地将女人他者化并加以歧视。可是女人呢？对于女人，厌女症是对自身的厌恶。”</p><p>“但女人也有可能不讲厌女症作为自我厌恶来体验，其方式就是把自己当做女人中的‘例外’，将除自己以外的女人‘他者化’，从而把厌女症转嫁出去。为此，有两种策略。一种是成为特权精英女人，被男人当做 ‘名誉男人’来对待，即成为 ‘女强人’的策略。另一种是自动退出 “女人”的范畴，从而逃脱被估价的女人身份，即 ‘丑女’政策。”</p><p>我当时采取的方法算是这两种策略的混合，一方面，努力学习，因为我知道好成绩在一定程度上能够为我赢得他人的尊重，从而获得被男人当做 “名誉男人”对待的待遇，另一方面从外表上偏离社会对女性穿着打扮的要求，以避免被当成女性评判。</p><h3 id="6"><a href="#6" class="headerlink" title="6"></a>6</h3><p>但以现在的眼光看当时我做的一切，其实是一种徒劳的、掩耳盗铃式的努力。</p><p>虽然我有交到一些尊重我的男性朋友，但整个男性群体并不会因为我的假小子形象，就不对我评头论足，不把我的名字写在女生颜值排行榜里。</p><p>父母也并不会因为我的男性化打扮，而减少对我的约束。</p><p>他们照样限制我出门，如果发现有男生往我家里打电话，或是翻到男生给我的情书，往往会归结于我的错，告诫我“不该招惹男生”，如果我顶嘴，则会被教育：“他怎么不找别人，就找你？”</p><p>那时的我并不知道如何为自己辩护。多年后，我才知道有个词叫“荡妇羞辱”，这是一种专门针对女性的言语暴力，用“荡妇”这个空泛又莫须有的罪名指责女性。</p><h3 id="7"><a href="#7" class="headerlink" title="7"></a>7</h3><p>最可笑的是，我其实也没有真的成功骗过自己。我虽然行为举止、着装打扮上像男生靠拢，但我就真的逃脱因为厌女症而自我厌恶的诅咒了吗？</p><p><strong>并没有。</strong></p><p>我体内的厌女症使得我处于低自尊的状态，更容易错误地自我归责，即使自己明明是受害者。</p><p>我刚工作时，有次被采访对象骚扰。我跟一个关系不错的同事倾诉，他问我穿什么衣服去做的采访，我说“裙子”，他就劝我穿衣服风格要稳重，不要太可爱，行为举止上也注意一点。“你太小姑娘了，对方就容易欺负你。” 他建议我像另一个夏天也穿长裤长袖、西服套装的姐姐学习职场如何着装。</p><p>那时的我真的觉得他说的有道理，觉得自己应该穿得更正式一些。</p><p>现在想来，他的这种论调其实是典型的“谴责受害者”。我被骚扰根本不是我的错，是骚扰者的错。用网上的一句话说，“强奸发生的唯一原因是有强奸犯。”</p><p>我当时该做的不应是反思自我，而应该是举报那个骚扰我的人，让他为自己的错误行为付出代价。</p><p>但直到现在，一有女性被骚扰／侵犯事件爆出，依然有很多人怪罪女性不知道自我保护。</p><p>但真正该做的是教育男性以及所有人尊重女性，让所有人知道，不论女生穿什么、几点出门、有没有喝醉酒、私生活如何，都不是你骚扰／侵犯她的理由。</p><p>(此处有配图，配图内容文字如下)</p><blockquote><p>It’s the boys who should be accused and asked why they do this. (该被谴责的应该是犯错的男孩，应该质问他们为什么要这么做。)</p></blockquote><h3 id="8"><a href="#8" class="headerlink" title="8"></a>8</h3><p>意识到自己有厌女症，以及自己身处的是一个厌女症普遍存在的社会，并不是一个愉快的经历。</p><p>我意识到，那些明明关爱我的人，曾经因为厌女症、男权思想的影响，怎样错误对待我，打压我的自尊和自信。</p><p>更难过的是，我意识到我曾怎样残忍对待自己——我否认、压抑、责怪自己体内那个女生。我为别人的错谴责自己。</p><p>但看见厌女症同时也是改变的契机。这就像你得先知道自己中了毒，你才会主动给自己解毒。</p><p>我写这篇文章的目的也是希望让更多人对自身的厌女症有所觉察、警惕和自省，减少因为厌女症而伤害自己和他人。</p><p>我找到的关于厌女症的解药是女权主义。（关于如何了解、认同、实践女权主义的过程，会另外撰文，因为这篇已经很长了?）</p><p>它让我清晰地了解到，我一直在追求的是平等对待，是不受性别刻板印象的束缚，活出真实自己。</p><p>只是当年的我以为阻碍我活的更自由的是我的性别，而如今我意识到，阻碍我的其实是普遍存在于我、你、Ta体内的男权思想和不平等的制度安排。</p><p>现在的我，拥抱自己的女性身份，为自己也为每一个女性呼吁，女性应该获得和男性平等的权利，承担平等的责任。</p><p>这不仅解放女性，也解放男性。平权会让我们每个人都活得更有力量、尊严和自由。</p><p>(此处有配图，配图内容文字如下)</p><blockquote><p>The real violence, the violence I realized was unforgivable, is the violence that we do to ourselves when we’re too afraid to be who we really are. (我意识到最不能原谅的真正暴力，是我们恐惧真实自我时，对自己施加的暴行。)</p></blockquote><p>剧照来自美剧《超感猎杀》和纪录片《印度的女儿》，插画来自插画师純</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;LGBT-相关（正文）&quot;&gt;&lt;a href=&quot;#LGBT-相关（正文）&quot; class=&quot;headerlink&quot; title=&quot;LGBT 相关（正文）&quot;&gt;&lt;/a&gt;LGBT 相关（正文）&lt;/h2&gt;&lt;p&gt;之前并没有了解过LGBT的消息。即使最近的这段时间微信正在大规模封锁</summary>
      
    
    
    
    <category term="c_好奇" scheme="https://tsz.me/categories/c-%E5%A5%BD%E5%A5%87/"/>
    
    
    <category term="LGBT" scheme="https://tsz.me/tags/LGBT/"/>
    
    <category term="跨性别" scheme="https://tsz.me/tags/%E8%B7%A8%E6%80%A7%E5%88%AB/"/>
    
    <category term="厌女症" scheme="https://tsz.me/tags/%E5%8E%8C%E5%A5%B3%E7%97%87/"/>
    
    <category term="社会排斥" scheme="https://tsz.me/tags/%E7%A4%BE%E4%BC%9A%E6%8E%92%E6%96%A5/"/>
    
    <category term="性别歧视" scheme="https://tsz.me/tags/%E6%80%A7%E5%88%AB%E6%AD%A7%E8%A7%86/"/>
    
    <category term="女权主义" scheme="https://tsz.me/tags/%E5%A5%B3%E6%9D%83%E4%B8%BB%E4%B9%89/"/>
    
  </entry>
  
  <entry>
    <title>Resilio Sync 工具使用手册</title>
    <link href="https://tsz.me/p/20210125_Resilio-Sync-%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C.html"/>
    <id>https://tsz.me/p/20210125_Resilio-Sync-%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C.html</id>
    <published>2021-01-25T10:44:39.000Z</published>
    <updated>2021-01-25T10:44:39.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Resilio Sync（曾经名为BitTorrent Sync）是由BitTorrent公司开发的专有的对等网络数据同步工具，可在全平台下使用。其可在局域网、互联网上通过安全的、分布式的P2P技术在不同设备之间同步文件。</p><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><h3 id="下载和安装"><a href="#下载和安装" class="headerlink" title="下载和安装"></a>下载和安装</h3><p>直接到<a href="https://www.resilio.com/individuals/">官网下载页</a>下载安装即可。不保证各地都能正常访问其官方主页。</p><p><del>亲也可以使用本站提供的备份档进行下载。备份档为Windows 64位版本的安装包，包含的Resilio Sync版本为2.7.2(1375)，文件MD5值87667db8c86ee0d3c3105baf5ffba929，sha-1值e02d96c7855085f5deb72c87a8297dd9baebb92d。备份档的提供日期为2020.12.31。</del></p><p>Resilio Sync Home (for personal use only)是免费的。</p><p>其他说明</p><ul><li>针对安卓手机用户，如果没有Google Play市场，可以到<a href="https://apkpure.com/cn/resilio-sync/com.resilio.sync">APKPure</a>下载安装 <del>（如果APKPure也无法访问的话，可以使用本站提供的备份档进行下载。备份档的APP版本为2.6.3，文件MD5值369ef85a97329b3874b4f9d5bfbbe4d6，sha-1值a8eb35945a2a8a29e06585438b5735afb59ecdea。备份档的提供日期为2021.1.21）</del>；</li><li>Mac用户如果在商店中搜索不到的话，可以去官网下载；</li><li>iOS用户可以直接在商店中搜索安装；</li><li>Windows用户<strong>推荐</strong>在安装时选择<strong>不</strong>注册为系统服务，并启用开机自动启动。</li></ul><h3 id="具体使用"><a href="#具体使用" class="headerlink" title="具体使用"></a>具体使用</h3><p>亲可以通过查看<a href="https://www.iplaysoft.com/bittorrent-sync.html">异次元软件世界的介绍</a>来对Resilio Sync产生一些感性上的认识。</p><p>高级的使用——同步个人的设备文件——我们这里不做过多讲解（这个需要自己多使用之后才会理清其中的原理），我们仅说明如何同步别人提供的分享文件。</p><p><img src="/images/QQ_20201231122226.png" alt="通过Sync从他人处接收文件"></p><p>点击左上角的+号，选择输入密钥或链接。</p><p><img src="/images/QQ_20201231122831.png" alt="输入密钥或链接"></p><p>输入密钥或链接。Sync 是一款基于 P2P 技术的文件同步与共享软件。里面的密钥（又称为key）可以说是一份资源的钥匙，相当与种子下载中的种子，通过不同的key我们可以连接上不同的资源。这里我们演示输入一个网上收集到的历史类电子书Sync密钥 <code>BSH7FXJFVWJTKWGSX5GTWX7PHZZ2D2M7Q</code>，然后<strong>开启选择性同步</strong>！！</p><ol><li>为什么要开启选择性同步？因为网上提供的资料体积可能会过于庞大，一下来个4T、6T的大小，亲的硬盘可能会吃不住。</li><li>为什么我无法开启选择性同步？因为这个软件桌面版的选择性同步功能是Pro版才支持的，亲需要自己<a href="https://www.baidu.com/s?ie=UTF-8&wd=Resilio%20Sync%20License%20%E6%8E%88%E6%9D%83%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD">搜索一个License授权文件</a>进行导入。本站不提供软件破解的哈。但是！安卓，iOS等移动设备的此功能是默认开启的，不需要升级版本，也不需要手工勾选任何选项。</li><li>为什么我的上面没有出现选择性同步的选项？亲看看自己复制的密钥对不对，是不是多了空格什么的。</li></ol><p><img src="/images/QQ_20201231123928.png" alt="输入密钥并开启选择性同步"></p><p>之后选择文件要同步到的本地目录，即可完成操作。</p><p><img src="/images/QQ_20201231130055.png" alt="选择要同步到的本地目录后，完成所有设定工作"></p><p>接下来的，亲应该就都会了。</p><h2 id="常见问题汇总"><a href="#常见问题汇总" class="headerlink" title="常见问题汇总"></a>常见问题汇总</h2><h3 id="在线用户少，速度上不去怎么办？"><a href="#在线用户少，速度上不去怎么办？" class="headerlink" title="在线用户少，速度上不去怎么办？"></a>在线用户少，速度上不去怎么办？</h3><p>那就等等看。2方面原因，一个是由于这个软件的中央服务器域名在中国被gfw了，导致客户端链接到的用户数量有限，另一个是有些网络可能并不好穿透，等一会儿速度就上来了。</p><h3 id="隔了很久想看-Sync-下载的文件，却发现消失了？"><a href="#隔了很久想看-Sync-下载的文件，却发现消失了？" class="headerlink" title="隔了很久想看 Sync 下载的文件，却发现消失了？"></a>隔了很久想看 Sync 下载的文件，却发现消失了？</h3><p>去隐藏文件夹（.sync）中找找！一般网上公开的资源秘钥都是只读 Key，只有发布者拥有完全控制权，这意味着发布者可以随时删除他认为已经过期或者无用的内容，用户端那边也会同步删除，这样你可能就与精彩内容失之交臂了。但是幸好 Sync 内置了存档功能并且默认是开启的，它会把已删除的内容移动到一个隐藏文件夹（.sync）中，类似于回收站，然后30天后才会彻底删除，所以如果发现资源消失了，不妨去隐藏文件夹中找找。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h2&gt;&lt;p&gt;Resilio Sync（曾经名为BitTorrent Sync）是由BitTorrent公司开发的专有的对等网络数据同步工具，可在全平台下</summary>
      
    
    
    
    <category term="c_新生代农民工" scheme="https://tsz.me/categories/c-%E6%96%B0%E7%94%9F%E4%BB%A3%E5%86%9C%E6%B0%91%E5%B7%A5/"/>
    
    
    <category term="软件" scheme="https://tsz.me/tags/%E8%BD%AF%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>xbox one 相关记录</title>
    <link href="//tsz.me/hardware/xbox-one.html"/>
    <id>//tsz.me/hardware/xbox-one.html</id>
    <published>2020-12-14T06:00:49.000Z</published>
    <updated>2020-12-14T06:00:49.000Z</updated>
    
    <content type="html"><![CDATA[<p>我小时挺喜欢到舅舅家玩超级玛丽的。闺女（老大）两三岁的时候，我希望能和她一起玩游戏，就想买台主机。可是2b的我并没有深入的了解对比，就从科技市场拿了台xbox one加体感回来……真应该先问问身边人的。假如我当时做些咨询……可是没有假如。（任天堂nb！）</p><p>车，枪，球。除了车还能玩玩，别的因为我手残都玩不动……买过2个游戏，然后就放在那里吃灰。<code>果真人们喜欢的只是花钱这个游戏。</code>游戏机默认送的1个手柄，我到现在都没有考虑过添置。</p><p>既然这样，<strong>那能不能把xbox one的手柄连接到iPad上呢？</strong> 答案是<strong>不能</strong>。我无法连接手柄到平板或电脑上。那为什么别人却可以，是不是我哪里做错了什么？是的，我不应该意淫的。</p><p>根据 <a href="https://www.pcmag.com/how-to/how-to-use-an-xbox-one-controller-on-a-pc">How to Connect an Xbox Controller to a PC - PCMag</a> 这篇文章所说</p><blockquote><p>Original Xbox One controllers lack wireless connectivity, but the gamepads that shipped with the  Xbox One S and later consoles include Xbox wireless communication and Bluetooth.</p></blockquote><p>原始的xb控制器是不支持蓝牙无线连接的。</p><blockquote><p>To determine whether you have a Bluetooth or non-Bluetooth Xbox controller, you need to look at the plastic surrounding the Guide button. If it’s the same plastic as the face of the controller, without any seams, you have a Bluetooth gamepad. If it’s the same plastic as the bumper buttons, with a seam between the Guide button and the controller’s face, it’s a non-Bluetooth gamepad. If it has a small, rectangular Capture button between the Menu and View buttons, and a USB-C port on the top instead of micro USB, it’s an Xbox Series controller and also has Bluetooth.</p></blockquote><p>具体区分是否支持蓝牙连接，请看上面文字。配合下图一起食用，效果更佳。</p><p><img src="/images/02bWHJeLGraOEdsVxYCSDhn-1.fit_lim.size_960x.jpg" alt="看看你是否和我一样悲催拥有一个球用没有的xb"></p><p>艹蛋。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;我小时挺喜欢到舅舅家玩超级玛丽的。闺女（老大）两三岁的时候，我希望能和她一起玩游戏，就想买台主机。可是2b的我并没有深入的了解对比，就从科技市场拿了台xbox one加体感回来……真应该先问问身边人的。假如我当时做些咨询……可是没有假如。（任天堂nb！）&lt;/p&gt;
&lt;p&gt;车，</summary>
      
    
    
    
    <category term="c_设备" scheme="https://tsz.me/categories/c-%E8%AE%BE%E5%A4%87/"/>
    
    
    <category term="记录" scheme="https://tsz.me/tags/%E8%AE%B0%E5%BD%95/"/>
    
    <category term="设备" scheme="https://tsz.me/tags/%E8%AE%BE%E5%A4%87/"/>
    
    <category term="游戏主机" scheme="https://tsz.me/tags/%E6%B8%B8%E6%88%8F%E4%B8%BB%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>我的视频制作尝试与想法（2022）</title>
    <link href="https://tsz.me/p/20200716_my-video-production-attempts-and-thoughts.html"/>
    <id>https://tsz.me/p/20200716_my-video-production-attempts-and-thoughts.html</id>
    <published>2020-07-16T02:17:48.000Z</published>
    <updated>2022-05-18T16:52:21.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="我对视频副业的想法（22-x2F-5-x2F-19）"><a href="#我对视频副业的想法（22-x2F-5-x2F-19）" class="headerlink" title="我对视频副业的想法（22&#x2F;5&#x2F;19）"></a>我对视频副业的想法（22&#x2F;5&#x2F;19）</h2><p>2020年那会儿，伴随着抖音B站的发展，视频（制作）行业好像一头在风口飞起的猪。我也是从那儿开始自学了一些Pr，想做个电影解说频道。我只做了一期，糟糕的后台数据让我充满挫败感。今年（2022年）中国经济下行的压力逼迫我重新审视开展视频副业的可能。根据近半个月的了解，我来说说我对视频某些方面的看法。</p><p>首先要说的是，视频是什么？与其说视频是种呈现方式，不如说<strong>它是一个工具。</strong>呈现方式仅仅是将它用作内容传播工具时的作用。这个问题其实就是你对视频制作的定位，定位很重要——你交女朋友时如果不以结婚为目的，就容易被人当作渣男。显然，我希望将它用作撑大钱包的工具，它得挣钱。</p><p>接下来就要确定它到底能不能撑大钱包了，看看这个行业的盈利模式。这<a href="https://m.mydrivers.com/newsview/831953.html">有篇文章</a>你看看，它总结了B站做up主的主要收入来源：</p><ol><li><del>平台发钱；</del>钱很少忽略不计</li><li>接广告打广告；前期粉少，需要自己用爱发电</li><li>自己承接流量转化变现工作；<strong>要求个人能力</strong></li></ol><p>我对这三点的总结：你可以<strong>把你的粉丝看做你的私域流量，但你要这些流量干什么还得自己先想好。</strong>在没想好这个问题之前，你可以先学着视频剪辑，但也不要忘了张朝阳的那句劝：「不要过度努力工作，因为世界不公平，方向错了会伤身体」。</p><p><img src="/images/sohu_zhang_chaoyang.png" alt="视频制作也是不公平的"></p><p>对于这个问题，我当前很困惑，找不到答案。如果你有想法，不妨一起聊聊。关于视频副业的其他问题，等我后续找到方向时再来补充。</p><h2 id="第一次尝试过程记录（2020-x2F-07-x2F-16）"><a href="#第一次尝试过程记录（2020-x2F-07-x2F-16）" class="headerlink" title="第一次尝试过程记录（2020&#x2F;07&#x2F;16）"></a>第一次尝试过程记录（2020&#x2F;07&#x2F;16）</h2><h3 id="文案"><a href="#文案" class="headerlink" title="文案"></a>文案</h3><p>大家好，这里是……</p><p>今天我们一起来看一部由盖·里奇执导，于2020年上映的犯罪题材影片《绅士们》。<br>本片采用多线叙事的方式，层层反转、为了方便大家观赏，我们采用正向的方式进行讲述。</p><p>米奇是一名美国人，聪明且穷。<br>他在英国读大学期间，通过销售大麻给家境富裕的同学，外加些硬核的操作，最终红手起家，逐步在欧洲大地上建立起一个年种植50吨、净利润过亿英镑的大麻帝国。<br>随着英国政府准备将大麻合法化，有过非法行为的他担心政府翻起旧账，便想借此机会退出圈子，从此和媳妇儿一起去安享生活。</p><p>要想在英国这片不大的土地上，年产50吨大麻，米奇也是另辟蹊径：<br>他在英国的几千个庄园中，选出12个没落贵族，通过每年提供一百万英镑佣金和额外服务，来换取这些勋爵场地的地下使用权，来进行大麻的种植活动。</p><p>曾经在一次聚会上，《每日邮报》的主编戴夫上前与米奇打招呼，但由于此主编曾报道过一位与米奇有过合作的贵族出轨同性男仆，导致该贵族最终事业沉寂、妻离子散，所以米奇并未鸟他。这让主编备感丢人，从而决定以15万的价格聘用私人侦探弗莱彻，来挖掘米奇的黑料，以期毁掉米奇。</p><p>米奇在一次高端饭局上，结识了犹太人马修。马修希望购买米奇的整个产业，对此，米奇将包括场所、工人、技术在内的基础建设和整个分销网络打包，报价4亿英镑。</p><p>犹太人马修尽管觉得4亿价格非常公道，却仍然希望能够通过使用手段来压低价格。于是他找到了中国人干眼。<br>干眼是卖白粉的乔治的手下，他充满了野心，是一名后起之秀。他在接到了马修的指示后，不仅背着他的首领乔治，同时还背着马修，透过米奇妻子的引见，直接与米奇面对面的坐下来，提出想要接手米奇生意的想法。<br>可是米奇出于产业已打算出售给马修的原因，拒绝了干眼的提议。</p><p>之后，米奇的农场遭到了几名搏击运动员的骚扰，原本用于交付给马修的400箱大麻也被搬走了。<br>至于整个抢劫的过程，还被运动员们制作成了视频上传到了网络。<code>（rap 剪辑 爽片）</code><br>网络的曝光使得米奇的不得不关闭了该农场，同时米奇也找来马修，希望消除马修的疑虑。<br>马修在此时将一把小手枪送给了米奇，寓意让米奇稳住当前的局面。</p><p>同时，一个与米奇有合作的贵族，他的女儿劳拉由于自我憎恨，离家出走，与一群坏家伙混在了一起，开始了海洛因的吸食。米奇决定帮助这位伙伴找回他的女儿。<br>米奇的助理——雷在即将顺利接回劳拉的时候出现了意外，一个人名叫阿斯兰的男子在相互推搡中跌出了窗户，这一幕同时被私家侦探、路边的小混混拍摄了下来。<br>雷一行人只得花费额外的精力从混混手中抢夺回来对方的手机，并将阿斯兰的尸体暂时放置到了雷家中的冰柜里。<br>此时，雷还不清楚，阿斯兰是一名俄罗斯寡头政治家的孩子。<code>（想拿钱买 绅士拿钱买，最终只得动用武力）4&#39;</code></p><p>当运动员的教练在得知整个事件的始末后，他带着运动员们接触的中间人法克，来到了米奇助理雷的地盘，主动道歉，并表示愿意归还货物，同时愿意作出补偿，以换取米奇放过这些孩子。<br>就这样，通过中间人法克，米奇知道了，他的场子是干眼打掉的。</p><p>雷带回来的劳拉最终因为海洛因死去了。<br>此时米奇也找上了干眼的首领乔治，烧毁了他的白粉作坊和其中的货物，同时用枪抵着乔治的头，警告乔治抢地盘的过火行为。</p><p>懵逼的乔治事后自然要去找干眼对质，干眼承认了自己的所作所为，并表示乔治属于前浪，被拍死在沙滩上才是正确的归宿。<br>乔治下令消除干眼的存在，不料手下却也被干眼收买，最终乔治背对着干眼，死在了下属手中。</p><p>乔治葬礼结束了。<br>米奇在餐厅遇到了俄国人派出的杀手，所幸雷及时出现，从后面将杀手爆头。<br>干眼则带着两名小弟来到米奇妻子的公司，希望将她挟持用作和米奇谈判的筹码。不料，这个狂野的女子使用马修之前赠送的手枪，干净利落的干掉了这两名手下。在子弹使用完毕后，米妻被干眼按在了桌子上，愤怒之余准备干一些羞羞的事。不巧的是，米奇此时赶到了这里，用不同的方式，让干眼一发入魂。<code>（龙头 巩固地位 想自立门户）</code></p><p>主编找来的私家侦探在调查了事情的始末后，主动找上了雷。他希望能够以2000万的价格，将他掌握的消息卖给雷，来得到比15万更丰厚的利润。他给出了72小时的时间，让雷去思考这笔买卖。<br>然而侦探却不知道，雷早已知道他在暗地进行调查，并且偷偷的在他的鞋中放入追踪器。在3天的时间里，雷让教练帮他找全了侦探额外留下用来当作保险的文档副本，同时还直接劫持了主编，通过给主编下药的方式，给主编拍下了与猪一起嘿嘿嘿的不雅视频……<br>另一方面，雷却不知道，侦探在卖消息给他之前，已经把消息卖给了俄国人，所以之前才会遇到俄国杀手……</p><p>侦探的调查，让米奇终于发现，整个事件背后的主谋就是犹太人马修。<br>本着“要成为王者，就不能迟疑”信念的米奇，要求马修为此支付2.7亿和身上的一磅肉作为补偿。</p><p>当这一切都处理完成后，米奇和雷分别遇到了俄国人派出的第二波杀手。<br>幸运的是，教练及其手下的运动员们，最终分别救下了他们。<br>而侦探也在打斗中，逃离了出去，继续去兜售这一系列事件富有戏剧色彩的剧情。</p><p>本片是观众熟悉的犯罪题材影片，带有导演自己的明显风格，阵容也堪称豪华。<br>虽然全球票房遇冷，但在口碑上却以8.3的评分连续数周入选豆瓣口碑榜。<br>全片随侦探的叙述推进，黑色幽默贯穿始终。角色们“猎人”和“猎物”的身份不断变换，让剧情充满悬疑。<br>且不说影片讲述的故事，单从学习角色们英伦风的穿衣打扮来讲，影片就值得一看。</p><p>好了，感谢大家本期的收看。欢迎大家留言吐槽……也欢迎订阅本频道，持续吐槽~<br>我们下期再见。</p><h3 id="视频链接及效果"><a href="#视频链接及效果" class="headerlink" title="视频链接及效果"></a>视频链接及效果</h3><p>&#x3D;&gt; 链接在此：<a href="https://www.youtube.com/watch?v=EcPujPcfxpY">vol.1.遇到中年危機的毒販不如意的退休之路 觀電影《紳士們&#x2F;瘋狂紳士幫&#x2F;紳士追殺令》</a><br>&#x3D;&gt; 视频效果：遇到电影的版权声明，<strong>YouTube黄标，限制播放。</strong>然后就没有然后了……</p><h3 id="视频制作过程中遇到的问题及解决"><a href="#视频制作过程中遇到的问题及解决" class="headerlink" title="视频制作过程中遇到的问题及解决"></a>视频制作过程中遇到的问题及解决</h3><p>等有人看的时候再来聊这个吧……显然，这不是我给自己挖的坑——我不认为会有人看。</p>]]></content>
    
    
    <summary type="html">本文记录了我在2020年尝试进行视频制作的相关资料，也梳理了我在2022年对视频副业的想法。</summary>
    
    
    
    <category term="原创" scheme="https://tsz.me/categories/%E5%8E%9F%E5%88%9B/"/>
    
    
    <category term="第三类" scheme="https://tsz.me/tags/%E7%AC%AC%E4%B8%89%E7%B1%BB/"/>
    
  </entry>
  
  <entry>
    <title>博客再搭建</title>
    <link href="https://tsz.me/p/20191223_%E5%8D%9A%E5%AE%A2%E5%86%8D%E6%90%AD%E5%BB%BA.html"/>
    <id>https://tsz.me/p/20191223_%E5%8D%9A%E5%AE%A2%E5%86%8D%E6%90%AD%E5%BB%BA.html</id>
    <published>2019-12-23T05:21:31.000Z</published>
    <updated>2021-09-09T07:37:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="废话"><a href="#废话" class="headerlink" title="废话"></a>废话</h2><p><strong>我一直搞不懂，写博客到底是为了什么。</strong></p><h3 id="回看"><a href="#回看" class="headerlink" title="回看"></a>回看</h3><p>已经记不清博客到底是在零几年兴起的，那时人们说着web2.0时代的到来。大一时我觉得好玩儿开了MSN Spaces。我不是一个拥有细腻感情的人，配合常年48分左右的作文成绩，我的文章写的很垮。平时偶尔在msn上放些我觉得新奇的技术类新闻，又或者一段笑话。人们都爱把自己的空间打扮得漂亮些。当时的网络氛围很好，大家像孩子一样天真热情的在网络上结交新朋友。我那时也有几个网友。在msn渐渐衰败的过程中，我和他们失去了联系。msn网络的访问，在当时看来也不是一般的慢……</p><p>后来，有了Google Page Creator。它就像现在的GitHub Pages，需要用户自己上传HTML。不过那时并没有html生成工具，制做html需要用到Dreamweaver或者直接敲代码，这就劝退了一些人。我在上面练习html制作，也写些文字来追妹子。那段日子，网吧生意很好，游戏在流行劲舞团、山口山，谷歌还没有被封锁。杀马特、葬爱家族的年代，不值得被留恋。</p><p>个人网站兴起了。我自己注册了域名，搭建了WordPress。我也替别人注册了域名，搭建了站点。我们文章更新的频率都不高。今天我的硬盘上没有一篇那时的存档，好像随着那人域名的到期，一切被清除了。If memory serves，从那时起大家减少了空间的互踩行为。这么多年过去了，顺便问下，谁能告诉我周杰伦的《以父之名》到底在表达什么？</p><p>微博在崛起，转向微博是理所当然的事。和现实的相识建立起联系，再关注些其他乱七八糟的人。推流永不停息。它带来了许多新问题。它是时间杀手，让人有事没事总想刷一刷，和现在的抖音很像，它们试图代替万有引力把我拉向衰老。它讲述的事是分散的、碎片化的，让我的思路有割裂的痕迹。我无法长时间集中注意力，这严重<strong>影响我阅读长文的能力</strong>。大脑不是CPU，我做不到在上下文中快速切换。<strong>系统性的知识才有可能提高人的认识</strong>，微博带来的只是更多无意义的混乱。它方便了日常记录，也提高了日后回顾整理的难度。清空内容，弃之。营销这个概念好像就是从这年夏天在大众间普及开的。多年后的某天我反思，关注特定行政部门账户来获取通知可能才是打开微博的正确方式。<del>微博清空过的热门话题也是有看头的。</del></p><p>换到wordrpress.com继续写字。国内网络环境已经恶化，wp属于墙外。我在wp上写流水账，熟人应该看不到。我也不一定每次都能看到……GoAgent可用的IP越来越难扫描。是的，我开始写流水账了，从最开始抄笑话退步到写日记。笑话能逗人笑，我的废柴日记可做不到。我不太清楚当时为什么这样做。如果非要我硬扯这样做的好处，我只能说它解决了微博不方便回顾的痛处。（屌丝有什么可回顾的？编不下去了……）</p><p>不能随时访问是个问题；日记是个人隐私，难免有不想被看到的“作案”记录。我重新在墙内搭建了Ghost，再配上个大家都不知道的域名。书写还在继续，现实有些冷清。我的文字显然不会有人看到。<strong>既然写出来的东西不想让人看，那为何还要写在网络上？</strong> 我这是在向暴露狂方向发展呐……日记是写给自己看的，对别人来说也没有意义呀。没有意义的东西，它没有存在的价值。如果日记是这样的，那笔记呢？网上充满各种问题的解决方法，搜索就可以得到结果。已经在网络上存在解决方法的问题，还有被记录的必要吗？我陷进自己给自己挖的坑里去。Ghost上的记录在升级Ghost的过程中遗失，Ghost用户请不要升级。</p><p>地球还在转，纠结的是自己。我把日记写在Word里，再打印出来，删除电子档，将纸质版归档。在逼乎上查找笔记的记录方式……事情很拧巴，人也很拧巴。</p><p>终于，切换到了OneNote。我受够了。纸质的资料写好后基本就不会再看，再看到的时候还不一定是自己！这就很吓人了。你挤出一篇日记是有条件的，一台打印机。Joplin + NAS WebDAV也是一个可以接受的方式。经历这么多困难我还在写日记，我对日记一定是真爱。</p><p>人上年纪了，就想输出些什么；混乱久了，就想理清些头绪；同一个等级待的时间长了，就想打怪升级。那时我读了本书，读后有些想法。我有分享的渴望，尽管人类的悲欢并不相通。年龄的增长让我对一些问题有了新的认识，我希望有个阐述自己观点的地方。与说教不同，与追求认同不同，我要<strong>把自己的认识系统化，让自己更了解自己，让内心更加自洽与平静。</strong> 至于了解更多未知的领域、加强自己的体验，相信它们最终会以这条道路的副产品身份出现。我又开博客了，Hexo on GitHub Pages。这里写的不是日记，是记录，是看法……它们每一篇可能都不够全面，但每次迭代都会使它更完善。Notion是一款管理软件，Obsidian是一款梳理软件。这个地方可能更像Obsidian。</p><p>欢迎有缘人。</p><h2 id="Hexo-配置记录"><a href="#Hexo-配置记录" class="headerlink" title="Hexo 配置记录"></a>Hexo 配置记录</h2><p><a href="https://sspai.com/post/54608">GitHub Pages 搭建教程</a> 里面讲了<code>GitHub账号的注册</code>、<code>Repository的创建</code>、<code>自定义域名及HTTPS配置</code>和<code>使用GitHub Desktop来同步网站</code>。</p><p>划下重点：</p><blockquote><p>在使用的时候项目和网站的大小不要超过 1GB，也不要过于频繁的更新网站的内容（每小时不超过 10 个版本），每个月的也要注意带宽使用上限为 100GB。</p></blockquote><p>补充说明下：</p><ul><li>Enforce HTTPS 点击后报错不生效，需要先清空自定义域名，在重新添加自定义域名后再勾选Enforce HTTPS。<strong>出现这种情况是因为在DNS指向前就先配置了自定义域名。</strong></li><li>GitHub Desktop 比命令行更适合新人。不用担心，<a href="https://stackoverflow.com/questions/34565238/where-does-github-desktop-install-command-line-version-of-git">GitHub Desktop 安装后本地依然有 git.exe</a>。</li><li>Jekyll vs Hexo vs Hugo 无意义，哪个都能写文章。坚持才是胜利。Jekyll 本地搭建过程有点繁琐。</li></ul><p><a href="https://hexo.io/zh-cn/docs/">Hexo官方文档</a> 有点老，但照着做依然能够快速完成搭建。反而 <a href="https://hexo.io/zh-cn/docs/configuration">Hexo的配置</a> 是最耗时的，有必要的话可以备份下配置文件。如果想被喂饭，请看《<a href="https://sspai.com/post/59337">记录生活，分享点滴：通过 Hexo 搭建与使用个人博客</a>》。</p><p>本站使用的模板是 <a href="https://github.com/fi3ework/hexo-theme-archer">Archer</a>。<a href="https://github.com/probberechts/hexo-theme-cactus">Cactus</a> 模板看着也不错。</p><h2 id="让-Hexo-更好用"><a href="#让-Hexo-更好用" class="headerlink" title="让 Hexo 更好用"></a>让 Hexo 更好用</h2><h3 id="在文章中插入图片"><a href="#在文章中插入图片" class="headerlink" title="在文章中插入图片"></a>在文章中插入图片</h3><p>用Hexo写作使用的是<a href="https://www.markdown.xyz/basic-syntax/">Markdown语法</a>，它并不难掌握。<code>![图片说明](图片地址)</code> 是md插入图片的语法。我并没有在Hexo的配置文件<code>_config.yml</code>中配置<code>post_asset_folder: true</code>对每篇博文启用单独的资源文件夹。我将图片统一放在<code>source/images</code>目录中，引用的地址是<code>/images/xxxx.jpg</code>这种形式。</p><p>在上传相机照片前，如果对自己的隐私有顾虑，可使用<a href="https://baike.baidu.com/item/Exif/422825">Exif</a>编辑器清除敏感数据。我使用的编辑工具是<a href="https://exiftool.org/">ExifTool</a>。查看一张照片的Exif信息可以使用命令<code>exiftool.exe 照片.jpg</code>（执行速度巨慢，要耐心），删除照片的Exif信息可执行<code>exiftool -all= 照片.jpg</code>。当然，你还可以使用<a href="https://github.com/mozilla/mozjpeg/releases">MozJPEG</a>，此时要执行的命令是<code>jpegtran.exe -copy none -outfile 没有Exif信息的照片名称.jpg 照片.jpg</code>。</p><p>空间是有限的，你可能还想压缩图片。MozJPEG中包含的cjpeg能帮上你。<code>cjpeg.exe -outfile 压缩后的文件名.jpg 想要压缩的照片.jpg</code>可以快速把图片质量降为75。</p><p>如果删除Exif信息的同时还想压缩图片，那最简单的方式就是把图片通过WeChat发送一份再另存下来。</p><p>下面是我写的一个bat脚本，通过调用MozJPEG来完成批量压缩照片的工作。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">:: batch_compress.bat</span><br><span class="line"><span class="built_in">title</span> 批量压缩图片文件</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> jpegtran=jpegtran-static.exe</span><br><span class="line"><span class="built_in">set</span> cjpeg=cjpeg-static.exe</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="variable">%%f</span> <span class="keyword">in</span> (img*.jpg) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">echo</span> 开始处理文件 <span class="variable">%%f</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> 无损压缩文件大小（移除文件的相机信息），生成临时文件 <span class="variable">%%~</span>nf.jtmp</span><br><span class="line">    <span class="variable">%jpegtran%</span> -<span class="built_in">copy</span> none -outfile <span class="variable">%%~</span>nf.jtmp <span class="variable">%%f</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> 进一步压缩文件大小（将图像质量设置到<span class="number">75</span>），生成最终文件 jt75_<span class="variable">%%f</span></span><br><span class="line">    <span class="variable">%cjpeg%</span> -outfile  jt75_<span class="variable">%%f</span>  <span class="variable">%%~</span>nf.jtmp</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> 删除临时文件 <span class="variable">%%~</span>nf.jtmp</span><br><span class="line">    <span class="built_in">del</span> <span class="variable">%%~</span>nf.jtmp</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span>.</span><br><span class="line">)</span><br><span class="line"><span class="built_in">echo</span> 完成所有图片的处理操作。<span class="number">5</span>秒后自动退出……</span><br><span class="line"><span class="built_in">ping</span> <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> -n <span class="number">5</span> &gt; <span class="built_in">nul</span></span><br></pre></td></tr></table></figure><p>如果照片上还有人的面部信息，<a href="https://github.com/Shawn-Shan/fawkes">Fawkes</a>是一个让照片屏蔽人脸识别算法的工具，<code>fawkes_binary_windows-v1.0.exe -d 图片所在的目录</code>你或许用的上。</p><h3 id="在文章中插入站内其他文章的链接"><a href="#在文章中插入站内其他文章的链接" class="headerlink" title="在文章中插入站内其他文章的链接"></a>在文章中插入站内其他文章的链接</h3><p><code>[链接显示的文字](链接地址)</code> 是md插入超链接的语法。</p><p>插入站内文章链接的方法是把上面的链接书写成<code>&#123;% post_link 另篇md博文的文件名 %&#125;</code>。跳转到其他文章的指定段落，网上说的<code>post_path</code>失败的概率较高，还是老实的用md的基础语法写相对链接吧。</p><h3 id="Hexo的迁移"><a href="#Hexo的迁移" class="headerlink" title="Hexo的迁移"></a>Hexo的迁移</h3><p>看这篇《<a href="https://www.zhihu.com/question/21193762">使用hexo，如果换了电脑怎么更新博客？</a>》选择适合你的方法。我用NAS进行所有终端的文件同步。</p><h3 id="Hexo的自动化"><a href="#Hexo的自动化" class="headerlink" title="Hexo的自动化"></a>Hexo的自动化</h3><p>网上文章有很多。现有的原始方式已经满足了我的使用，暂时不去做研究。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;废话&quot;&gt;&lt;a href=&quot;#废话&quot; class=&quot;headerlink&quot; title=&quot;废话&quot;&gt;&lt;/a&gt;废话&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;我一直搞不懂，写博客到底是为了什么。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;回看&quot;&gt;&lt;a href=&quot;#回看&quot; clas</summary>
      
    
    
    
    <category term="c_生活" scheme="https://tsz.me/categories/c-%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="记录" scheme="https://tsz.me/tags/%E8%AE%B0%E5%BD%95/"/>
    
    <category term="配置" scheme="https://tsz.me/tags/%E9%85%8D%E7%BD%AE/"/>
    
  </entry>
  
  <entry>
    <title>我的键盘清单</title>
    <link href="https://tsz.me/p/20160909_my-keyboards.html"/>
    <id>https://tsz.me/p/20160909_my-keyboards.html</id>
    <published>2016-09-09T02:49:36.000Z</published>
    <updated>2022-05-19T09:56:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="我对键盘的感受"><a href="#我对键盘的感受" class="headerlink" title="我对键盘的感受"></a>我对键盘的感受</h2><p>只要打起字来不是特别难受，什么样的键盘我都ok。键程过于短的键盘打起字来就很难受。像ThinkPad这样的键程，我不认为它短。我说的短是过分的那种，想象一下正常指法直接在桌面上打字的感受，这就是反人类。薄膜键盘与机械键盘没有谁好谁坏，我用过一款微软的薄膜键盘打起来很有感觉。恩，干活才是主要的，不干活没饭吃。</p><p>如果在网上搜索<code>薄膜键盘 vs 机械键盘</code>，那机械键盘已经被彩虹屁吹上天了。大可不必。<code>老式机械键盘(A)</code>由于自己的不足，被优等生<code>薄膜键盘(B)</code>干翻了；时间推移，班里新来个白富美<code>new机械键盘(C)</code>；B和C的人缘都不差，一些有闲又有钱的同学更想追求C。这段感情不狗血，八卦一下。怎么，你也想了解C的性情特点？<del>小道消息<strong>严肃(并不)的机械键盘入(shao)门(qian)指南</strong>送上。（链接z-shang.gitcafe.io&#x2F;serious-kbd-guide.html已失效）</del></p><h2 id="我的键盘"><a href="#我的键盘" class="headerlink" title="我的键盘"></a>我的键盘</h2><h3 id="Poker3-2016"><a href="#Poker3-2016" class="headerlink" title="Poker3(2016)"></a>Poker3(2016)</h3><p>我看中的是机械键盘的全键无冲。一巴掌按在键盘上，所有字符同时上屏的感觉不要不要的~如果能够脱离驱动、软件或操作系统层面进行键位重排或宏录制，那就更好不过了。在对比了<a href="https://input.club/devices/infinity-keyboard/">Infinity无刻</a>和IKBC Poker 3后，我选择了后者。我买的是白色青轴，599大洋。机械键盘在我看来，只有青轴与红轴。青轴清脆的按键声能让码农在搬砖时直接起飞。Infinity和Poker都是60%（61键）键盘，对程序猿来说足够了，小巧的体积让它容易塞进背包。Infinity的键位要自己烧录；Poker自带QWERTY、Dvorak和Colemak三种键盘布局，额外支持3套自定义布局，且无需在电脑上配置额外环境，利用键盘上的<code>FN</code>、<code>PN</code>按键即可完成按键编程。相较无刻的好看，实用更让人看中。成年人也会做选择。</p><p>键盘用了这么久，我来说说使用感受：</p><ol><li>白色的键盘容易脏。这跟洗不洗手没关系，按键会黑，但不影响使用，盲打不看键盘。如果你在键盘旁吃午饭，它也不会影响食欲。</li><li>青轴声音太响，会影响同事午休，会<strong>影响使用</strong>。你中午时候不得不跟着大家一起睡。</li><li>Poker太沉，它的底座是金属的。不影响使用，却不便携。</li></ol><p><strong>经验教训：红轴可能会是更好的选择；颜色能不选白色就不选白色。</strong>2022年它吃灰4年了。</p><p>&#x3D;&gt; 官方<a href="http://www.ikbc.com.cn/Private/Files/6370865664483702981425927015.pdf">Poker II 说明书</a>，找不到Poker3的。</p><h3 id="Cherry3494-2018"><a href="#Cherry3494-2018" class="headerlink" title="Cherry3494(2018)"></a>Cherry3494(2018)</h3><p>最近不敲代码改打字了。所在的初创公司穷，提供的双飞燕（不是借代修辞手法，就是双飞燕品牌）还不是全新的……按键不灵敏顺滑，需要用大力气。一段话打下来就能让我耗尽精血。我决定自己添置生产工具。单论码字，Poker键盘太小，我需要更多按键来提升效率。接受历史教训（青轴声音太响），Cherry G80-3494红轴走起，869大洋带走。我没有其他的颜色选项，只能还是白色。使用上没啥特别的，该变黑的地方总会变黑的。</p><p><strong>使用感受：这是笔不该产生的费用。一副简单的新键盘就能解决问题。</strong>但是在2022年的今天，它还是我的主力键盘。</p><h3 id="K380-2020"><a href="#K380-2020" class="headerlink" title="K380(2020)"></a>K380(2020)</h3><p>电子设备多了。PC外，平板也有打字需求。接受历史教训（只买对的不买贵的），185元入手罗技K380。K380也是小键盘，更轻，薄。它通过蓝牙与设备进行无线连接，支持在3个设备间快速切换。</p><p>使用感受：平板确是在做为生产力工具使用，它没有沦为爱奇艺启动器。这值得欣慰。这次的失误在于我<strong>错估了自己在移动设备上使用键盘的频率。</strong>pencil虽然使用起来准确率不高，但在使用门槛、便携性和功能性上，它都轻松击败键盘。好在K380能连多台设备，没有触控笔的手机也能用。总的来说，这次剁手有失误，可弥补，错的不是很离谱。</p>]]></content>
    
    
    <summary type="html">我对Poker3/Cherry3494/K380键盘的使用感受。</summary>
    
    
    
    <category term="原创" scheme="https://tsz.me/categories/%E5%8E%9F%E5%88%9B/"/>
    
    
    <category term="生活类" scheme="https://tsz.me/tags/%E7%94%9F%E6%B4%BB%E7%B1%BB/"/>
    
  </entry>
  
  <entry>
    <title>Raspberry Pi 使用记录</title>
    <link href="https://tsz.me/hardware/raspberry-pi.html"/>
    <id>https://tsz.me/hardware/raspberry-pi.html</id>
    <published>2014-07-16T08:14:12.000Z</published>
    <updated>2021-02-22T09:33:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="2021-2-22-更新"><a href="#2021-2-22-更新" class="headerlink" title="2021.2.22 更新"></a>2021.2.22 更新</h2><p>前段时间手贱执行了 <code>sudo apt upgrade</code>，然后系统就再也起不来了……恰好那时也没用打印机的需求，就一直没重新安装系统。这会儿闲了，处理并记录一下。</p><ol><li>正常安装操作系统，这次我选的是 lite</li><li>在 boot 下面新建 ssh 文件开启远程连接：默认用户名是 <code>pi</code>，密码是 <code>raspberry</code></li><li><code>sudo passwd root</code>  &#x2F;&#x2F; 设置 root 密码，但不允许 root 远程登陆</li><li><code>sudo raspi-config</code>  &#x2F;&#x2F; 扩展磁盘</li><li>更换软件源（可选）后执行 <code>sudo apt update</code> 和 <code>sudo apt upgrade</code> 更新下系统（未来数十年，它就这样在防火墙后孤独终老吧！我应该不会在 pi 上欠抽第二次了）</li></ol><h3 id="安装打印机"><a href="#安装打印机" class="headerlink" title="安装打印机"></a>安装打印机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install cups</span><br><span class="line">sudo apt install hplip  // 惠普的东东</span><br><span class="line">sudo cupsctl --remote-any  // 允许远程登陆。未执行 pi 用户授权，直接使用 root 用户在网页上添加打印机</span><br><span class="line">sudo systemctl restart cups</span><br><span class="line"></span><br><span class="line">sudo hp-setup -i  // --- <span class="string">&quot;Filter failed&quot;</span></span><br></pre></td></tr></table></figure><hr><p><strong>买个 pi，着实没球用……</strong></p><h2 id="2015-11-01-更新"><a href="#2015-11-01-更新" class="headerlink" title="2015.11.01 更新"></a>2015.11.01 更新</h2><p>给 pi 重装系统，发现 <strong>E450 自带的读卡器无法使用</strong>。买个外置的，25大洋。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;2021-2-22-更新&quot;&gt;&lt;a href=&quot;#2021-2-22-更新&quot; class=&quot;headerlink&quot; title=&quot;2021.2.22 更新&quot;&gt;&lt;/a&gt;2021.2.22 更新&lt;/h2&gt;&lt;p&gt;前段时间手贱执行了 &lt;code&gt;sudo apt upgra</summary>
      
    
    
    
    <category term="c_设备" scheme="https://tsz.me/categories/c-%E8%AE%BE%E5%A4%87/"/>
    
    
    <category term="记录" scheme="https://tsz.me/tags/%E8%AE%B0%E5%BD%95/"/>
    
    <category term="配置" scheme="https://tsz.me/tags/%E9%85%8D%E7%BD%AE/"/>
    
    <category term="设备" scheme="https://tsz.me/tags/%E8%AE%BE%E5%A4%87/"/>
    
  </entry>
  
  <entry>
    <title>做菜练习</title>
    <link href="https://tsz.me/p/20140603_%E5%81%9A%E8%8F%9C%E7%BB%83%E4%B9%A0.html"/>
    <id>https://tsz.me/p/20140603_%E5%81%9A%E8%8F%9C%E7%BB%83%E4%B9%A0.html</id>
    <published>2014-06-03T14:34:47.000Z</published>
    <updated>2021-09-02T10:43:47.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="个人尝试"><a href="#个人尝试" class="headerlink" title="个人尝试"></a>个人尝试</h2><p>这段时间学习炒菜，记录一下便于日后改进。</p><h3 id="番茄炒鸡蛋"><a href="#番茄炒鸡蛋" class="headerlink" title="番茄炒鸡蛋"></a>番茄炒鸡蛋</h3><blockquote><p>之所以要练习这道菜，是因为我吃别人做的鸡蛋番茄都有些淡淡的甜味……但老娘做的这道菜却不是这样的。</p></blockquote><p>做法如下：炒蛋后出锅。</p><p>再炒西红柿，后加入炒好的鸡蛋、盐、糖，然后出锅。</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>下次可以在炒西红柿前爆葱花，同时尝试用生抽提鲜。</p><h3 id="糖醋里脊"><a href="#糖醋里脊" class="headerlink" title="糖醋里脊"></a>糖醋里脊</h3><p>里脊切条，伴蛋清、盐、白胡椒腌制一会儿。</p><p>里脊沾生粉入锅炸，捞出后复炸一次。</p><p>番茄酱加白糖、清水煮开后加淀粉水收汁时关火，倒入里脊拌匀。</p><p>撒芝麻，出锅。</p><blockquote><p>原本想在家人面前装逼露一手的打算，从这次尝试的结果上来看，估计要失败。</p></blockquote><h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><ul><li>腌制时好像没有搅拌均匀，有些肉有胡椒的味道，下次换十三香试试；</li><li>有一部分肉外焦里不嫩，另外一些外不焦里不嫩，下次得想个办法让外焦里嫩才好；</li><li>12块钱的里脊有点多，如果一个人吃的话，我觉得7元的里脊就差不多了；</li><li>做汁时加水多了一些，导致颜色不够鲜艳，下次注意少加水；</li><li>至于淀粉水中淀粉的量，我暂时还不清楚其中关系，暂时没有修改意见；</li><li>芝麻撒多了也不好吃，下次少加一些。</li></ul><h3 id="醋溜豆芽"><a href="#醋溜豆芽" class="headerlink" title="醋溜豆芽"></a>醋溜豆芽</h3><p>起油锅，辣椒爆锅后倒入绿豆芽翻炒。</p><p>加盐、糖、醋再翻炒后，盖锅焖一会儿，起锅。</p><blockquote><p>感觉夏天路边的炒豆芽酸辣味挺好吃的。我自己做的这道菜量太大了！（1块5毛钱的豆芽）快给我吃吐了（主要是因为做的难吃，没辣味只有浓浓的酸味）……</p></blockquote><h4 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h4><ul><li>4个红辣椒太少了，一点也不辣，只是香。下次在量上至少要12个，而且也不知道是不是因为炸的太过了才不辣的，所以下次要想办法让辣椒既辣又香；</li><li>下次在爆的时候可以尝试加入葱、姜、蒜；</li><li>这次买的是1.5元的豆芽，多到一个人吃不完，下次估计7毛的就够了；</li><li>这次倒的醋有些多了，下次注意少放一点；</li><li>此次还放了糖，下次停止放糖，同时再稍多一点盐。</li></ul><h2 id="他人技巧"><a href="#他人技巧" class="headerlink" title="他人技巧"></a>他人技巧</h2><ul><li>排骨汤里要加米酒。（未测试）</li></ul><hr><h2 id="2021-9-2-更新"><a href="#2021-9-2-更新" class="headerlink" title="2021.9.2 更新"></a>2021.9.2 更新</h2><p>这个记录帖无限期停止更新。我结婚了呀。而且媳妇儿挺喜欢研究做饭的……<strong>不能夺人所好。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;个人尝试&quot;&gt;&lt;a href=&quot;#个人尝试&quot; class=&quot;headerlink&quot; title=&quot;个人尝试&quot;&gt;&lt;/a&gt;个人尝试&lt;/h2&gt;&lt;p&gt;这段时间学习炒菜，记录一下便于日后改进。&lt;/p&gt;
&lt;h3 id=&quot;番茄炒鸡蛋&quot;&gt;&lt;a href=&quot;#番茄炒鸡蛋&quot; class</summary>
      
    
    
    
    <category term="c_生活" scheme="https://tsz.me/categories/c-%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="吃" scheme="https://tsz.me/tags/%E5%90%83/"/>
    
    <category term="记录" scheme="https://tsz.me/tags/%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
</feed>
